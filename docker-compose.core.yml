# ═══════════════════════════════════════════════════════════════════════════
# BizOSaaS Core Services Stack
# ═══════════════════════════════════════════════════════════════════════════
# Contains: Infrastructure (Embedded), API Gateway, MCP Servers
# ═══════════════════════════════════════════════════════════════════════════

services:
  # ========================================
  # API Gateway
  # ========================================
  brain-gateway:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/brain-gateway:staging
    build:
      context: ./bizosaas-brain-core/brain-gateway
      dockerfile: Dockerfile
    container_name: bizosaas-brain-staging
    expose:
      - "8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - VECTOR_DB_URL=${VECTOR_DB_URL}
      - REDIS_URL=${REDIS_URL}
      - JWT_SECRET=${JWT_SECRET}
      - TEMPORAL_HOST=${TEMPORAL_HOST}
      - TEMPORAL_NAMESPACE=${TEMPORAL_NAMESPACE}
      - USE_VAULT=true
      - VAULT_ADDR=http://app-hack-multi-byte-application-um7u9p:8200
      - VAULT_TOKEN=${VAULT_TOKEN:-staging-root-token-bizosaas-2025}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-https://app.bizoholic.net,https://admin.bizoholic.net,https://bizoholic.net}
    networks:
      - brain-network
      - dokploy-network
    deploy:
      resources:
        limits:
          cpus: '0.4'
          memory: 1G
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=dokploy-network"
