<<<<<<< HEAD
services:
  brain-gateway:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/brain-gateway:staging
    container_name: bizosaas-brain-staging
    environment:
      - DATABASE_URL=postgresql://neondb_owner:npg_puEbTnkSO9F8@ep-gentle-flower-a15rdh2r-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
      - REDIS_URL=redis://default:Gt7QxXA4ybMzYzD9e6KIBULfnv1IU6f9@redis-10690.c264.ap-south-1-1.ec2.cloud.redislabs.com:10690/0
      - TEMPORAL_ADDRESS=ap-south-2.aws.api.temporal.io:7233
      - TEMPORAL_HOST=ap-south-2.aws.api.temporal.io:7233
      - TEMPORAL_NAMESPACE=bizosaas.ap-south-2
      - VAULT_URL=https://vault.bizoholic.net
      - VAULT_TOKEN=hvs.REpC92zP7vH29X04y1vX4Wn
      - WORDPRESS_URL=http://bizoholicwebsite-wordpress-rbtyli
      - AI_AGENTS_URL=http://ai-agents:8000
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.brain-gateway-stg.rule=Host(`api.bizoholic.net`)"
      - "traefik.http.routers.brain-gateway-stg.entrypoints=websecure"
      - "traefik.http.routers.brain-gateway-stg.tls.certresolver=letsencrypt"
      - "traefik.http.routers.brain-gateway-stg.priority=1000"
      - "traefik.http.routers.brain-gateway-stg.service=brain-gateway-stg-svc"
      - "traefik.http.services.brain-gateway-stg-svc.loadbalancer.server.port=8000"
      - "traefik.docker.network=dokploy-network"
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "--fail", "http://127.0.0.1:8000/health" ]
=======
# BizOSaaS Platform - Core Infrastructure Services
# Start with essential infrastructure first

services:
  # ===========================================
  # INFRASTRUCTURE SERVICES
  # ===========================================
  postgres:
    image: ankane/pgvector:v0.5.1
    container_name: bizosaas-postgres-unified
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: Bizoholic2024Alagiri
      POSTGRES_DB: bizosaas
      POSTGRES_MULTIPLE_DATABASES: wagtail,saleor
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./infrastructure/database/init.sql:/docker-entrypoint-initdb.d/01-init.sql
      - ./infrastructure/database/create-multiple-dbs.sh:/docker-entrypoint-initdb.d/02-create-multiple-dbs.sh
    networks:
      - bizosaas-platform-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d bizosaas"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

  redis:
    image: redis:7-alpine
    container_name: bizosaas-redis-unified
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - bizosaas-platform-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 10s
      retries: 5

  # FastAPI Brain - Enhanced AI Agentic Hub (Port 8001)
  bizosaas-brain:
    build:
      context: ./ai/services/bizosaas-brain
      dockerfile: Dockerfile
    container_name: bizosaas-brain-unified
    ports:
      - "8001:8001"
    environment:
      DATABASE_URL: postgresql://postgres:Bizoholic2024Alagiri@postgres:5432/bizosaas
      REDIS_URL: redis://redis:6379/0
      OPENAI_API_KEY: ${OPENAI_API_KEY:-dummy-key}
      JWT_SECRET: ${JWT_SECRET:-bizosaas-central-secret-key}
      SECRET_KEY: bizosaas-brain-secret-key-production
      ENVIRONMENT: production
      ENABLE_METRICS: "1"
      SMTP_HOST: ${SMTP_HOST:-smtp.gmail.com}
      SMTP_PORT: ${SMTP_PORT:-587}
      SMTP_USERNAME: ${SMTP_USERNAME:-}
      SMTP_PASSWORD: ${SMTP_PASSWORD:-}
      FROM_EMAIL: ${FROM_EMAIL:-noreply@bizosaas.com}
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - bizosaas-platform-network
    restart: unless-stopped
    volumes:
      - ./ai/services/bizosaas-brain:/app
      - /app/__pycache__
      - /app/node_modules
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
>>>>>>> 689624bdacbb85634f44c01400300bc3ce37e57e
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
<<<<<<< HEAD
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1024M
        reservations:
          cpus: '0.5'
          memory: 512M

  brain-mcp-brave-search:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/brave-search-mcp:staging
    container_name: brain-mcp-brave-search
    environment:
      - BRAVE_API_KEY=${BRAVE_API_KEY}
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-filesystem:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/filesystem-mcp:staging
    container_name: brain-mcp-filesystem
    volumes:
      - bizosaas-data:/data
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-github:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/github-mcp:staging
    container_name: brain-mcp-github
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-google-drive:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/google-drive-mcp:staging
    container_name: brain-mcp-google-drive
    environment:
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-slack:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/slack-mcp:staging
    container_name: brain-mcp-slack
    environment:
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-fluentcrm:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/fluentcrm-mcp:staging
    container_name: brain-mcp-fluentcrm
    environment:
      - FLUENTCRM_URL=${FLUENTCRM_URL}
      - FLUENTCRM_API_KEY=${FLUENTCRM_API_KEY}
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-meesho:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/meesho-mcp:staging
    container_name: brain-mcp-meesho
    environment:
      - MEESHO_API_KEY=${MEESHO_API_KEY}
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  ai-agents:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/ai-agents:staging
    container_name: bizosaas-ai-agents-staging
    build:
      context: ./bizosaas-brain-core/ai-agents
      dockerfile: Dockerfile
    environment:
      - DATABASE_URL=postgresql://neondb_owner:npg_puEbTnkSO9F8@ep-gentle-flower-a15rdh2r-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
      - REDIS_URL=redis://default:Gt7QxXA4ybMzYzD9e6KIBULfnv1IU6f9@redis-10690.c264.ap-south-1-1.ec2.cloud.redislabs.com:10690/1
      - VAULT_ADDR=https://vault.bizoholic.net
      - VAULT_TOKEN=hvs.REpC92zP7vH29X04y1vX4Wn
      - BRAIN_API_URL=http://brain-gateway:8000
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8000/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1024M
        reservations:
          cpus: '0.5'
          memory: 512M

networks:
  brain-network:
    external: true
    name: brain-network
  dokploy-network:
    external: true
    name: dokploy-network

volumes:
  bizosaas-data:
    external: true
=======

# ===========================================
# NETWORKS & VOLUMES
# ===========================================
networks:
  bizosaas-platform-network:
    driver: bridge
    name: bizosaas-platform-network

volumes:
  postgres_data:
    name: bizosaas-postgres-data
  redis_data:
    name: bizosaas-redis-data
>>>>>>> 689624bdacbb85634f44c01400300bc3ce37e57e
