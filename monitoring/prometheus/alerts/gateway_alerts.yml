groups:
- name: brain_gateway_alerts
  rules:
  - alert: HighErrorRate
    expr: sum(rate(http_request_duration_seconds_count{status=~"5.."}[5m])) / sum(rate(http_request_duration_seconds_count[5m])) > 0.1
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "High HTTP 5xx error rate on {{ $labels.instance }}"
      description: "Error rate is above 10% for more than 2 minutes."

  - alert: SlowResponses
    expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le)) > 2
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High P95 latency on {{ $labels.instance }}"
      description: "95th percentile of response time is above 2s for more than 5 minutes."

  - alert: ConnectorDown
    expr: connector_errors_total > 5
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "Connector {{ $labels.connector_type }} is experiencing errors"
      description: "More than 5 errors detected for {{ $labels.connector_type }} in the last minute."

  - alert: HighCpuUsage
    expr: system_cpu_percent > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High CPU usage on {{ $labels.instance }}"
      description: "CPU usage is above 85% for more than 5 minutes."
