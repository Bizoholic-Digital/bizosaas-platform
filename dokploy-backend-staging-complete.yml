# BizOSaaS Backend Services - STAGING Environment (Complete)
# All backend services for full SaaS platform

services:
  # ==========================================
  # BRAIN API - AI Central Hub
  # Main API coordinator for all services
  # ==========================================
  brain-api:
    build:
      context: https://github.com/Bizoholic-Digital/bizosaas-platform.git#main
      dockerfile: bizosaas-platform/ai/services/bizosaas-brain/Dockerfile
    container_name: bizosaas-brain-staging
    ports:
      - "8001:8001"
    environment:
      - NODE_ENV=staging
      - DATABASE_URL=postgresql://admin:BizOSaaS2025!StagingDB@bizosaas-postgres-staging:5432/bizosaas_staging
      - REDIS_URL=redis://bizosaas-redis-staging:6379/0
      - VAULT_ADDR=http://bizosaas-vault-staging:8200
      - VAULT_TOKEN=staging-root-token-bizosaas-2025
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    networks:
      - dokploy-network
    restart: unless-stopped

  # ==========================================
  # WAGTAIL CMS
  # Headless content management
  # ==========================================
  wagtail-cms:
    build:
      context: https://github.com/Bizoholic-Digital/bizosaas-platform.git#main
      dockerfile: bizosaas-platform/backend/services/cms/Dockerfile
    container_name: bizosaas-wagtail-staging
    ports:
      - "8002:8002"
    environment:
      - DJANGO_SETTINGS_MODULE=wagtail_cms.settings.staging
      - DATABASE_URL=postgresql://admin:BizOSaaS2025!StagingDB@bizosaas-postgres-staging:5432/bizosaas_staging
      - REDIS_URL=redis://bizosaas-redis-staging:6379/1
      - SECRET_KEY=${DJANGO_SECRET_KEY}
      - ALLOWED_HOSTS=stg.bizoholic.com,bizosaas-wagtail-staging
    networks:
      - dokploy-network
    restart: unless-stopped

  # ==========================================
  # DJANGO CRM
  # Customer relationship management
  # ==========================================
  django-crm:
    build:
      context: https://github.com/Bizoholic-Digital/bizosaas-platform.git#main
      dockerfile: bizosaas-platform/backend/services/crm/django-crm/Dockerfile
    container_name: bizosaas-django-crm-staging
    ports:
      - "8003:8003"
    environment:
      - DJANGO_SETTINGS_MODULE=django_crm.settings.staging
      - DATABASE_URL=postgresql://admin:BizOSaaS2025!StagingDB@bizosaas-postgres-staging:5432/bizosaas_staging
      - REDIS_URL=redis://bizosaas-redis-staging:6379/2
      - SECRET_KEY=${DJANGO_CRM_SECRET_KEY}
      - ALLOWED_HOSTS=stg.bizoholic.com,bizosaas-django-crm-staging
    networks:
      - dokploy-network
    restart: unless-stopped

  # ==========================================
  # BUSINESS DIRECTORY API
  # Directory service backend
  # ==========================================
  directory-api:
    build:
      context: https://github.com/Bizoholic-Digital/bizosaas-platform.git#main
      dockerfile: bizosaas-platform/backend/services/crm/business-directory/Dockerfile
    container_name: bizosaas-directory-api-staging
    ports:
      - "8004:8004"
    environment:
      - NODE_ENV=staging
      - DATABASE_URL=postgresql://admin:BizOSaaS2025!StagingDB@bizosaas-postgres-staging:5432/bizosaas_staging
      - REDIS_URL=redis://bizosaas-redis-staging:6379/3
    networks:
      - dokploy-network
    restart: unless-stopped

  # ==========================================
  # SALEOR E-COMMERCE PLATFORM
  # Full-featured e-commerce API
  # ==========================================
  saleor-api:
    image: ghcr.io/saleor/saleor:3.20
    container_name: bizosaas-saleor-staging
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://admin:BizOSaaS2025!StagingDB@bizosaas-postgres-staging:5432/saleor_staging
      - REDIS_URL=redis://bizosaas-redis-staging:6379/7
      - SECRET_KEY=${SALEOR_SECRET_KEY}
      - ALLOWED_HOSTS=stg.coreldove.com,bizosaas-saleor-staging,localhost
      - DEBUG=true
      - DEFAULT_FROM_EMAIL=noreply@stg.coreldove.com
      - CELERY_BROKER_URL=redis://bizosaas-redis-staging:6379/7
    networks:
      - dokploy-network
    restart: unless-stopped

networks:
  dokploy-network:
    external: true

# ==================================================
# BACKEND SERVICES PROJECT SUMMARY (COMPLETE):
# ==================================================
# Container Count: 5 (essential backend services)
# Purpose: Complete backend for SaaS platform
# Services:
#   - Brain API (8001) - AI coordinator
#   - Wagtail CMS (8002) - Content management
#   - Django CRM (8003) - Customer management
#   - Directory API (8004) - Business directory
#   - Saleor API (8000) - E-commerce platform
# Dependencies: Infrastructure (PostgreSQL, Redis, Vault)
# ==================================================
