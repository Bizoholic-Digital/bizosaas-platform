services:
  admin-dashboard:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/admin-dashboard:staging
    container_name: bizosaas-admin-dashboard-staging
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_API_BASE_URL=https://api.bizoholic.net
      - NEXT_PUBLIC_API_URL=https://api.bizoholic.net
      - NEXT_PUBLIC_SUPERSET_URL=https://bi.bizoholic.net
      - NEXT_PUBLIC_TEMPORAL_UI_URL=https://temporal.bizoholic.net
      - NEXT_TELEMETRY_DISABLED=1
      - AUTH_SERVICE_URL=https://api.bizoholic.net/auth
      - NEXTAUTH_URL=https://admin.bizoholic.net
      - NEXTAUTH_SECRET=${AUTH_SECRET:-BizOSaaS2025!Secret!NextAuth}
      - AUTH_SECRET=${AUTH_SECRET:-BizOSaaS2025!Secret!NextAuth}
      - AUTHENTIK_ISSUER=${AUTH_AUTHENTIK_ISSUER:-https://auth-sso.bizoholic.net/application/o/bizosaas-platform/}
      - AUTHENTIK_CLIENT_ID=${AUTH_AUTHENTIK_ID:-bizosaas-portal}
      - AUTHENTIK_CLIENT_SECRET=${AUTH_AUTHENTIK_SECRET:-BizOSaaS2024!AuthentikSecret}
      - AUTH_AUTHENTIK_ID=${AUTH_AUTHENTIK_ID:-bizosaas-portal}
      - AUTH_AUTHENTIK_SECRET=${AUTH_AUTHENTIK_SECRET:-BizOSaaS2024!AuthentikSecret}
      - AUTH_AUTHENTIK_ISSUER=${AUTH_AUTHENTIK_ISSUER:-https://auth-sso.bizoholic.net/application/o/bizosaas-platform/}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID:-}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET:-}
      - VAULT_ADDR=${VAULT_URL:-}
      - VAULT_TOKEN=${VAULT_TOKEN:-}
      - VAULT_SECRET_PATH=${VAULT_SECRET_PATH:-bizosaas/stg/admin-dashboard}
      - VAULT_MOUNT_POINT=${VAULT_MOUNT_POINT:-secret}
      - AUTH_TRUST_HOST=true
      - PORT=3000
    networks:
      - dokploy-network
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '0.4'
          memory: 512M
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/api/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.admin-dashboard-stg.rule=Host(`admin.bizoholic.net`)"
      - "traefik.http.routers.admin-dashboard-stg.entrypoints=websecure"
      - "traefik.http.routers.admin-dashboard-stg.tls.certresolver=letsencrypt"
      - "traefik.http.routers.admin-dashboard-stg.priority=1000"
      - "traefik.http.routers.admin-dashboard-stg.service=admin-dashboard-stg-svc"
      - "traefik.http.services.admin-dashboard-stg-svc.loadbalancer.server.port=3000"
      - "traefik.docker.network=dokploy-network"

networks:
  dokploy-network:
    external: true
