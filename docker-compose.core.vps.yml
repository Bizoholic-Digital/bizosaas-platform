version: "3.8"
services:
  brain-gateway:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/brain-gateway:staging
    container_name: bizosaas-brain-staging
    volumes:
      - ./bizosaas-brain-core/brain-gateway/app/api/onboarding.py:/app/app/api/onboarding.py
    environment:
      - DATABASE_URL=postgresql://neondb_owner:npg_puEbTnkSO9F8@ep-gentle-flower-a15rdh2r-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
      - REDIS_URL=redis://default:Gt7QxXA4ybMzYzD9e6KIBULfnv1IU6f9@redis-10690.c264.ap-south-1-1.ec2.cloud.redislabs.com:10690/0
      - TEMPORAL_ADDRESS=ap-south-2.aws.api.temporal.io:7233
      - TEMPORAL_NAMESPACE=bizosaas.ap-south-2
      - VAULT_URL=https://vault.bizoholic.net
      - VAULT_TOKEN=hvs.REpC92zP7vH29X04y1vX4Wn
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=dokploy-network"
      - "traefik.http.routers.compose-synthesize-online-feed-gb95pq-42-web.middlewares=redirect-to-https@file"
      - "traefik.http.routers.compose-synthesize-online-feed-gb95pq-42-web.rule=Host(`api.bizoholic.net`)"
      - "traefik.http.routers.compose-synthesize-online-feed-gb95pq-42-web.service=compose-synthesize-online-feed-gb95pq-42-web"
      - "traefik.http.routers.compose-synthesize-online-feed-gb95pq-42-websecure.entrypoints=websecure"
      - "traefik.http.routers.compose-synthesize-online-feed-gb95pq-42-websecure.rule=Host(`api.bizoholic.net`)"
      - "traefik.http.routers.compose-synthesize-online-feed-gb95pq-42-websecure.service=compose-synthesize-online-feed-gb95pq-42-websecure"
      - "traefik.http.routers.compose-synthesize-online-feed-gb95pq-42-websecure.tls.certresolver=letsencrypt"
      - "traefik.http.services.compose-synthesize-online-feed-gb95pq-42-websecure.loadbalancer.server.port=8000"
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import urllib.request; urllib.request.urlopen('http://127.0.0.1:8000/health')" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1024M
        reservations:
          cpus: '0.5'
          memory: 512M

  brain-mcp-brave-search:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/brave-search-mcp:staging
    container_name: brain-mcp-brave-search
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-filesystem:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/filesystem-mcp:staging
    container_name: brain-mcp-filesystem
    volumes:
      - bizosaas-data:/data
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-github:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/github-mcp:staging
    container_name: brain-mcp-github
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-google-drive:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/google-drive-mcp:staging
    container_name: brain-mcp-google-drive
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-slack:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/slack-mcp:staging
    container_name: brain-mcp-slack
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

  brain-mcp-fluentcrm:
    image: ghcr.io/bizoholic-digital/bizosaas-platform/fluentcrm-mcp:staging
    container_name: brain-mcp-fluentcrm
    networks:
      - brain-network
      - dokploy-network
    expose:
      - 8000
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python3", "-c", "import socket; s = socket.socket(); s.connect(('127.0.0.1', 8000))" ]
      interval: 30s
      timeout: 10s
      retries: 3
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 128M

networks:
  brain-network:
    external: true
    name: brain-network
  dokploy-network:
    external: true
    name: dokploy-network

volumes:
  bizosaas-data:
    external: true
