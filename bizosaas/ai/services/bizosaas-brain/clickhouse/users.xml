<?xml version="1.0"?>
<!--
  ClickHouse Users Configuration for BizOSaaS Analytics
  Multi-tenant user management with security isolation
-->
<clickhouse>
    <profiles>
        <default>
            <max_memory_usage>10000000000</max_memory_usage>
            <use_uncompressed_cache>0</use_uncompressed_cache>
            <load_balancing>random</load_balancing>
            <max_query_size>268435456</max_query_size>
            <max_ast_depth>1000</max_ast_depth>
            <max_ast_elements>50000</max_ast_elements>
            <max_expanded_ast_elements>500000</max_expanded_ast_elements>
            <readonly>0</readonly>
            <max_rows_to_read>0</max_rows_to_read>
            <max_bytes_to_read>0</max_bytes_to_read>
            <max_execution_time>0</max_execution_time>
            <max_columns_to_read>0</max_columns_to_read>
        </default>

        <readonly>
            <readonly>1</readonly>
        </readonly>

        <!-- Analytics profile for Superset queries -->
        <analytics_readonly>
            <max_memory_usage>20000000000</max_memory_usage>
            <max_execution_time>300</max_execution_time>
            <max_rows_to_read>1000000000</max_rows_to_read>
            <max_bytes_to_read>10000000000</max_bytes_to_read>
            <readonly>1</readonly>
            <allow_ddl>0</allow_ddl>
            <max_concurrent_queries_for_user>10</max_concurrent_queries_for_user>
        </analytics_readonly>

        <!-- ETL profile for data loading -->
        <etl_profile>
            <max_memory_usage>30000000000</max_memory_usage>
            <max_execution_time>1800</max_execution_time>
            <max_rows_to_read>0</max_rows_to_read>
            <max_bytes_to_read>0</max_bytes_to_read>
            <readonly>0</readonly>
            <allow_ddl>1</allow_ddl>
            <max_concurrent_queries_for_user>5</max_concurrent_queries_for_user>
        </etl_profile>
    </profiles>

    <users>
        <!-- Default admin user -->
        <default>
            <password></password>
            <networks incl="networks_config" />
            <profile>default</profile>
            <quota>default</quota>
        </default>

        <!-- Analytics user for Superset -->
        <analytics>
            <password>clickhouse_secure_password</password>
            <networks incl="networks_config" />
            <profile>analytics_readonly</profile>
            <quota>analytics_quota</quota>
            <databases>
                <database>analytics</database>
                <database>system</database>
            </databases>
            <!-- Row-level security for multi-tenancy -->
            <access_management>1</access_management>
        </analytics>

        <!-- ETL user for data loading -->
        <etl_user>
            <password>etl_secure_password</password>
            <networks incl="networks_config" />
            <profile>etl_profile</profile>
            <quota>etl_quota</quota>
            <databases>
                <database>analytics</database>
            </databases>
            <access_management>1</access_management>
        </etl_user>
    </users>

    <quotas>
        <default>
            <interval>
                <duration>3600</duration>
                <queries>0</queries>
                <errors>0</errors>
                <result_rows>0</result_rows>
                <read_rows>0</read_rows>
                <execution_time>0</execution_time>
            </interval>
        </default>

        <!-- Analytics quota for Superset -->
        <analytics_quota>
            <interval>
                <duration>3600</duration>
                <queries>1000</queries>
                <errors>100</errors>
                <result_rows>10000000</result_rows>
                <read_rows>100000000</read_rows>
                <execution_time>3600</execution_time>
            </interval>
        </analytics_quota>

        <!-- ETL quota for data loading -->
        <etl_quota>
            <interval>
                <duration>3600</duration>
                <queries>100</queries>
                <errors>10</errors>
                <result_rows>0</result_rows>
                <read_rows>0</read_rows>
                <execution_time>7200</execution_time>
            </interval>
        </etl_quota>
    </quotas>

    <networks_config>
        <ip>::/0</ip>
    </networks_config>
</clickhouse>