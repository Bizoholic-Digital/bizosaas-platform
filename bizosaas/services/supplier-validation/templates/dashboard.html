<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Validation Dashboard - BizOSaaS Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
        }

        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), #1e40af);
            color: white;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .main-content {
            background-color: #f8fafc;
            min-height: 100vh;
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-card.success {
            background: linear-gradient(135deg, var(--success-color), #059669);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
        }

        .stat-card.danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
        }

        .stat-card.info {
            background: linear-gradient(135deg, var(--info-color), #0891b2);
        }

        .workflow-step {
            position: relative;
            padding: 20px;
            border-left: 3px solid #e5e7eb;
        }

        .workflow-step.completed {
            border-left-color: var(--success-color);
        }

        .workflow-step.current {
            border-left-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }

        .workflow-step.pending {
            border-left-color: var(--secondary-color);
        }

        .risk-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .risk-low {
            background-color: #d1fae5;
            color: #065f46;
        }

        .risk-medium {
            background-color: #fef3c7;
            color: #92400e;
        }

        .risk-high {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .risk-critical {
            background-color: #fce7f3;
            color: #831843;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .document-card {
            border: 2px dashed #e5e7eb;
            transition: all 0.3s ease;
        }

        .document-card:hover {
            border-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }

        .approval-timeline {
            position: relative;
        }

        .approval-timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e5e7eb;
        }

        .approval-step {
            position: relative;
            padding-left: 60px;
            margin-bottom: 30px;
        }

        .approval-step::before {
            content: '';
            position: absolute;
            left: 14px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #e5e7eb;
        }

        .approval-step.completed::before {
            background-color: var(--success-color);
        }

        .approval-step.current::before {
            background-color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: -250px;
                width: 250px;
                z-index: 1000;
                transition: left 0.3s ease;
            }

            .sidebar.show {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="fw-bold">BizOSaaS</h4>
                        <p class="small mb-0">Supplier Validation</p>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="dashboard">
                                <i class="fas fa-chart-pie me-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="suppliers">
                                <i class="fas fa-building me-2"></i>
                                Suppliers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="pending-review">
                                <i class="fas fa-clock me-2"></i>
                                Pending Review
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="documents">
                                <i class="fas fa-file-alt me-2"></i>
                                Documents
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="risk-assessment">
                                <i class="fas fa-shield-alt me-2"></i>
                                Risk Assessment
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="workflows">
                                <i class="fas fa-project-diagram me-2"></i>
                                Workflows
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="analytics">
                                <i class="fas fa-chart-bar me-2"></i>
                                Analytics
                            </a>
                        </li>
                    </ul>

                    <hr class="my-4">

                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown">
                            <img src="https://github.com/mdo.png" alt="" width="32" height="32" class="rounded-circle me-2">
                            <strong>Analyst User</strong>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Sign out</a></li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2" id="page-title">Supplier Validation Dashboard</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-primary" onclick="registerNewSupplier()">
                                <i class="fas fa-plus me-2"></i>Register Supplier
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="refreshData()">
                                <i class="fas fa-sync-alt me-2"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div id="dashboard-section" class="content-section">
                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-building fa-2x"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="h4 mb-0" id="total-suppliers">0</div>
                                            <div class="small">Total Suppliers</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card stat-card warning">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-clock fa-2x"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="h4 mb-0" id="pending-review">0</div>
                                            <div class="small">Pending Review</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card stat-card success">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-check-circle fa-2x"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="h4 mb-0" id="approved-suppliers">0</div>
                                            <div class="small">Approved</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="card stat-card danger">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-times-circle fa-2x"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="h4 mb-0" id="rejected-suppliers">0</div>
                                            <div class="small">Rejected</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Recent Activity -->
                    <div class="row">
                        <div class="col-lg-8 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Risk Level Distribution</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="riskChart" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Recent Activity</h5>
                                </div>
                                <div class="card-body">
                                    <div id="recent-activity" class="approval-timeline">
                                        <!-- Recent activity will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="row">
                        <div class="col-12 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Quick Actions</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <button class="btn btn-outline-primary w-100" onclick="showPendingReviews()">
                                                <i class="fas fa-eye d-block mb-2"></i>
                                                Review Pending
                                            </button>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <button class="btn btn-outline-success w-100" onclick="bulkApprove()">
                                                <i class="fas fa-check-double d-block mb-2"></i>
                                                Bulk Approve
                                            </button>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <button class="btn btn-outline-warning w-100" onclick="generateReport()">
                                                <i class="fas fa-file-pdf d-block mb-2"></i>
                                                Generate Report
                                            </button>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <button class="btn btn-outline-info w-100" onclick="exportData()">
                                                <i class="fas fa-download d-block mb-2"></i>
                                                Export Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Suppliers Section -->
                <div id="suppliers-section" class="content-section" style="display: none;">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">All Suppliers</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table id="suppliers-table" class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Company Name</th>
                                                    <th>Contact Person</th>
                                                    <th>Industry</th>
                                                    <th>Status</th>
                                                    <th>Risk Level</th>
                                                    <th>Risk Score</th>
                                                    <th>Created Date</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be loaded via AJAX -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other sections will be similar... -->
                <div id="pending-review-section" class="content-section" style="display: none;">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Suppliers Pending Review</h5>
                                </div>
                                <div class="card-body">
                                    <div id="pending-suppliers-list">
                                        <!-- Pending suppliers will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Supplier Registration Modal -->
    <div class="modal fade" id="supplierModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Register New Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supplier-form">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="company_name" class="form-label">Company Name *</label>
                                <input type="text" class="form-control" id="company_name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="contact_person" class="form-label">Contact Person *</label>
                                <input type="text" class="form-control" id="contact_person" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone *</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="address" class="form-label">Address *</label>
                                <textarea class="form-control" id="address" rows="2" required></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="city" class="form-label">City *</label>
                                <input type="text" class="form-control" id="city" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="state" class="form-label">State *</label>
                                <input type="text" class="form-control" id="state" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="pincode" class="form-label">Pincode *</label>
                                <input type="text" class="form-control" id="pincode" pattern="[0-9]{6}" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="business_type" class="form-label">Business Type *</label>
                                <select class="form-select" id="business_type" required>
                                    <option value="">Select Business Type</option>
                                    <option value="Private Limited Company">Private Limited Company</option>
                                    <option value="Public Limited Company">Public Limited Company</option>
                                    <option value="Partnership">Partnership</option>
                                    <option value="Sole Proprietorship">Sole Proprietorship</option>
                                    <option value="LLP">Limited Liability Partnership</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="industry" class="form-label">Industry *</label>
                                <input type="text" class="form-control" id="industry" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="gst_number" class="form-label">GST Number</label>
                                <input type="text" class="form-control" id="gst_number" pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="pan_number" class="form-label">PAN Number</label>
                                <input type="text" class="form-control" id="pan_number" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="website" class="form-label">Website</label>
                                <input type="url" class="form-control" id="website">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="employee_count" class="form-label">Employee Count</label>
                                <input type="number" class="form-control" id="employee_count" min="1">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="products_offered" class="form-label">Products/Services Offered *</label>
                            <textarea class="form-control" id="products_offered" rows="3" placeholder="Enter comma-separated list of products/services" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitSupplierForm()">Register Supplier</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Review Modal -->
    <div class="modal fade" id="reviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Supplier Review</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Supplier review content will be loaded here -->
                    <div id="review-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net@1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datatables.net-bs5@1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Global variables
        let currentSupplier = null;
        let suppliersTable = null;
        
        // API base URL
        const API_BASE = 'http://localhost:8027';
        
        // Initialize the dashboard
        $(document).ready(function() {
            initializeDashboard();
            setupEventListeners();
            loadDashboardData();
        });
        
        function initializeDashboard() {
            // Initialize DataTable
            suppliersTable = $('#suppliers-table').DataTable({
                ajax: {
                    url: `${API_BASE}/suppliers`,
                    dataSrc: 'suppliers'
                },
                columns: [
                    { data: 'company_name' },
                    { data: 'contact_person' },
                    { data: 'industry' },
                    { 
                        data: 'status',
                        render: function(data) {
                            return getStatusBadge(data);
                        }
                    },
                    { 
                        data: 'risk_level',
                        render: function(data) {
                            return getRiskBadge(data);
                        }
                    },
                    { 
                        data: 'risk_score',
                        render: function(data) {
                            return `${data.toFixed(1)}%`;
                        }
                    },
                    { 
                        data: 'created_at',
                        render: function(data) {
                            return new Date(data).toLocaleDateString();
                        }
                    },
                    {
                        data: null,
                        render: function(data, type, row) {
                            return `
                                <button class="btn btn-sm btn-primary" onclick="reviewSupplier('${row.id}')">
                                    <i class="fas fa-eye"></i> Review
                                </button>
                                <button class="btn btn-sm btn-info" onclick="viewRiskAssessment('${row.id}')">
                                    <i class="fas fa-shield-alt"></i> Risk
                                </button>
                            `;
                        }
                    }
                ],
                responsive: true,
                pageLength: 25,
                order: [[6, 'desc']] // Sort by created date descending
            });
        }
        
        function setupEventListeners() {
            // Navigation
            $('.nav-link').click(function(e) {
                e.preventDefault();
                
                $('.nav-link').removeClass('active');
                $(this).addClass('active');
                
                const section = $(this).data('section');
                showSection(section);
            });
        }
        
        function showSection(sectionName) {
            $('.content-section').hide();
            $(`#${sectionName}-section`).show();
            
            // Update page title
            const titles = {
                'dashboard': 'Supplier Validation Dashboard',
                'suppliers': 'All Suppliers',
                'pending-review': 'Pending Review',
                'documents': 'Document Management',
                'risk-assessment': 'Risk Assessment',
                'workflows': 'Workflow Management',
                'analytics': 'Analytics & Reports'
            };
            
            $('#page-title').text(titles[sectionName] || 'Dashboard');
            
            // Load section-specific data
            switch(sectionName) {
                case 'suppliers':
                    suppliersTable.ajax.reload();
                    break;
                case 'pending-review':
                    loadPendingSuppliers();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }
        
        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE}/dashboard/analytics`);
                const data = await response.json();
                
                // Update stats cards
                $('#total-suppliers').text(data.summary.total_suppliers);
                $('#pending-review').text(data.summary.pending_review);
                $('#approved-suppliers').text(data.summary.approved_suppliers);
                $('#rejected-suppliers').text(data.summary.rejected_suppliers);
                
                // Update risk chart
                updateRiskChart(data.risk_distribution);
                
                // Update recent activity
                updateRecentActivity(data.recent_activity);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading dashboard data', 'error');
            }
        }
        
        function updateRiskChart(riskData) {
            const ctx = document.getElementById('riskChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Risk', 'Medium Risk', 'High Risk', 'Critical Risk'],
                    datasets: [{
                        data: [
                            riskData.low || 0,
                            riskData.medium || 0,
                            riskData.high || 0,
                            riskData.critical || 0
                        ],
                        backgroundColor: [
                            '#10b981',
                            '#f59e0b',
                            '#ef4444',
                            '#be185d'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function updateRecentActivity(activities) {
            const container = $('#recent-activity');
            container.empty();
            
            activities.slice(0, 5).forEach(activity => {
                const item = $(`
                    <div class="approval-step">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">${activity.company_name}</h6>
                                <p class="mb-1 small text-muted">${getStatusBadge(activity.status)}</p>
                                <small class="text-muted">${getRiskBadge(activity.risk_level)} • Score: ${activity.risk_score}%</small>
                            </div>
                            <small class="text-muted">${new Date(activity.created_at).toLocaleDateString()}</small>
                        </div>
                    </div>
                `);
                container.append(item);
            });
        }
        
        function getStatusBadge(status) {
            const statusConfig = {
                'pending': { class: 'bg-secondary', text: 'Pending' },
                'under_review': { class: 'bg-warning', text: 'Under Review' },
                'documents_required': { class: 'bg-info', text: 'Documents Required' },
                'compliance_check': { class: 'bg-primary', text: 'Compliance Check' },
                'manager_review': { class: 'bg-warning', text: 'Manager Review' },
                'director_approval': { class: 'bg-warning', text: 'Director Approval' },
                'approved': { class: 'bg-success', text: 'Approved' },
                'rejected': { class: 'bg-danger', text: 'Rejected' },
                'suspended': { class: 'bg-dark', text: 'Suspended' },
                'blacklisted': { class: 'bg-danger', text: 'Blacklisted' }
            };
            
            const config = statusConfig[status] || { class: 'bg-secondary', text: status };
            return `<span class="badge ${config.class}">${config.text}</span>`;
        }
        
        function getRiskBadge(riskLevel) {
            const riskConfig = {
                'low': { class: 'risk-low', text: 'Low Risk' },
                'medium': { class: 'risk-medium', text: 'Medium Risk' },
                'high': { class: 'risk-high', text: 'High Risk' },
                'critical': { class: 'risk-critical', text: 'Critical Risk' }
            };
            
            const config = riskConfig[riskLevel] || { class: 'risk-medium', text: riskLevel };
            return `<span class="risk-badge ${config.class}">${config.text}</span>`;
        }
        
        function registerNewSupplier() {
            $('#supplierModal').modal('show');
        }
        
        async function submitSupplierForm() {
            const formData = {
                company_name: $('#company_name').val(),
                contact_person: $('#contact_person').val(),
                email: $('#email').val(),
                phone: $('#phone').val(),
                address: $('#address').val(),
                city: $('#city').val(),
                state: $('#state').val(),
                pincode: $('#pincode').val(),
                business_type: $('#business_type').val(),
                industry: $('#industry').val(),
                website: $('#website').val() || null,
                employee_count: parseInt($('#employee_count').val()) || null,
                gst_number: $('#gst_number').val() || null,
                pan_number: $('#pan_number').val() || null,
                products_offered: $('#products_offered').val().split(',').map(p => p.trim())
            };
            
            try {
                const response = await fetch(`${API_BASE}/suppliers/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer your-token-here'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showNotification(`Supplier ${formData.company_name} registered successfully!`, 'success');
                    $('#supplierModal').modal('hide');
                    $('#supplier-form')[0].reset();
                    
                    // Refresh data
                    loadDashboardData();
                    if (suppliersTable) {
                        suppliersTable.ajax.reload();
                    }
                } else {
                    const error = await response.json();
                    showNotification(`Error: ${error.detail}`, 'error');
                }
            } catch (error) {
                console.error('Error registering supplier:', error);
                showNotification('Error registering supplier', 'error');
            }
        }
        
        async function reviewSupplier(supplierId) {
            try {
                const response = await fetch(`${API_BASE}/suppliers/${supplierId}`);
                const data = await response.json();
                
                currentSupplier = data.supplier;
                
                // Build review content
                const reviewContent = buildReviewContent(data);
                $('#review-content').html(reviewContent);
                $('#reviewModal').modal('show');
                
            } catch (error) {
                console.error('Error loading supplier for review:', error);
                showNotification('Error loading supplier details', 'error');
            }
        }
        
        function buildReviewContent(data) {
            const supplier = data.supplier;
            const documents = data.documents || [];
            const workflow = data.workflow;
            
            return `
                <div class="row">
                    <div class="col-md-8">
                        <h5>Supplier Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Company:</strong> ${supplier.company_name}</p>
                                <p><strong>Contact:</strong> ${supplier.contact_person}</p>
                                <p><strong>Email:</strong> ${supplier.email}</p>
                                <p><strong>Phone:</strong> ${supplier.phone}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Industry:</strong> ${supplier.industry}</p>
                                <p><strong>Business Type:</strong> ${supplier.business_type}</p>
                                <p><strong>GST:</strong> ${supplier.gst_number || 'N/A'}</p>
                                <p><strong>PAN:</strong> ${supplier.pan_number || 'N/A'}</p>
                            </div>
                        </div>
                        
                        <h5 class="mt-4">Documents</h5>
                        <div class="row">
                            ${documents.map(doc => `
                                <div class="col-md-6 mb-3">
                                    <div class="document-card card p-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1">${doc.document_type.replace('_', ' ').toUpperCase()}</h6>
                                                <small class="text-muted">${doc.file_name}</small>
                                            </div>
                                            <span class="badge ${doc.verification_status === 'verified' ? 'bg-success' : 'bg-warning'}">
                                                ${doc.verification_status}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <h5 class="mt-4">Review Decision</h5>
                        <form id="review-form">
                            <div class="mb-3">
                                <label class="form-label">Decision</label>
                                <div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="decision" value="approve" id="approve">
                                        <label class="form-check-label" for="approve">Approve</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="decision" value="reject" id="reject">
                                        <label class="form-check-label" for="reject">Reject</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="decision" value="request_more_info" id="request_more_info">
                                        <label class="form-check-label" for="request_more_info">Request More Info</label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="comments" class="form-label">Comments</label>
                                <textarea class="form-control" id="comments" rows="4" required></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">Risk Assessment</h6>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <div class="h2 mb-0">${supplier.risk_score}%</div>
                                    <div>${getRiskBadge(supplier.risk_level)}</div>
                                </div>
                                <button class="btn btn-outline-primary btn-sm w-100" onclick="viewRiskAssessment('${supplier.id}')">
                                    View Full Assessment
                                </button>
                            </div>
                        </div>
                        
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="card-title mb-0">Workflow Status</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Current Step:</strong> ${workflow ? workflow.current_step : 'N/A'}</p>
                                <p><strong>Status:</strong> ${getStatusBadge(supplier.status)}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="submitReview()">Submit Review</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function submitReview() {
            const decision = $('input[name="decision"]:checked').val();
            const comments = $('#comments').val();
            
            if (!decision || !comments) {
                showNotification('Please select a decision and provide comments', 'warning');
                return;
            }
            
            const reviewData = {
                supplier_id: currentSupplier.id,
                decision: decision,
                comments: comments
            };
            
            try {
                const response = await fetch(`${API_BASE}/suppliers/${currentSupplier.id}/review`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer your-token-here'
                    },
                    body: JSON.stringify(reviewData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showNotification(`Review submitted successfully: ${result.message}`, 'success');
                    $('#reviewModal').modal('hide');
                    
                    // Refresh data
                    loadDashboardData();
                    if (suppliersTable) {
                        suppliersTable.ajax.reload();
                    }
                } else {
                    const error = await response.json();
                    showNotification(`Error: ${error.detail}`, 'error');
                }
            } catch (error) {
                console.error('Error submitting review:', error);
                showNotification('Error submitting review', 'error');
            }
        }
        
        async function viewRiskAssessment(supplierId) {
            try {
                const response = await fetch(`${API_BASE}/suppliers/${supplierId}/risk-assessment`);
                const assessment = await response.json();
                
                // Show risk assessment in a modal or expand view
                console.log('Risk Assessment:', assessment);
                showNotification('Risk assessment loaded - check console for details', 'info');
                
            } catch (error) {
                console.error('Error loading risk assessment:', error);
                showNotification('Error loading risk assessment', 'error');
            }
        }
        
        function showNotification(message, type = 'info') {
            const alertType = type === 'error' ? 'danger' : type;
            const alert = $(`
                <div class="alert alert-${alertType} alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 9999;">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `);
            
            $('body').append(alert);
            
            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                alert.alert('close');
            }, 5000);
        }
        
        function refreshData() {
            loadDashboardData();
            if (suppliersTable) {
                suppliersTable.ajax.reload();
            }
            showNotification('Data refreshed', 'success');
        }
        
        // Additional utility functions
        function showPendingReviews() {
            showSection('pending-review');
        }
        
        function bulkApprove() {
            showNotification('Bulk approve feature coming soon', 'info');
        }
        
        function generateReport() {
            showNotification('Report generation feature coming soon', 'info');
        }
        
        function exportData() {
            showNotification('Data export feature coming soon', 'info');
        }
        
        function loadPendingSuppliers() {
            // Implementation for loading pending suppliers
            showNotification('Loading pending suppliers...', 'info');
        }
        
        function loadAnalytics() {
            // Implementation for loading analytics
            showNotification('Loading analytics...', 'info');
        }
    </script>
</body>
</html>