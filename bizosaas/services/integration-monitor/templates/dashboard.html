<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizOSaaS Integration Monitor - Live Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f1419;
            color: #ffffff;
            overflow-x: hidden;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: #1a1f26;
            border-right: 1px solid #2d3748;
            padding: 20px;
        }

        .sidebar h2 {
            color: #4fc3f7;
            font-size: 18px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-section {
            margin-bottom: 30px;
        }

        .nav-section h3 {
            color: #9ca3af;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            color: #d1d5db;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
            margin-bottom: 4px;
        }

        .nav-item:hover, .nav-item.active {
            background: #374151;
            color: #ffffff;
        }

        .main-content {
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2d3748;
        }

        .header h1 {
            font-size: 28px;
            color: #ffffff;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #059669;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-indicator.warning {
            background: #d97706;
        }

        .status-indicator.error {
            background: #dc2626;
        }

        .pulse {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #1a1f26;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-title {
            color: #9ca3af;
            font-size: 14px;
            font-weight: 500;
        }

        .metric-icon {
            font-size: 20px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .metric-subtitle {
            color: #6b7280;
            font-size: 14px;
        }

        .metric-trend {
            color: #10b981;
            font-size: 12px;
            font-weight: 500;
        }

        .metric-trend.down {
            color: #ef4444;
        }

        .integrations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .integration-card {
            background: #1a1f26;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
        }

        .integration-card.healthy {
            border-left: 4px solid #10b981;
        }

        .integration-card.degraded {
            border-left: 4px solid #f59e0b;
        }

        .integration-card.unhealthy {
            border-left: 4px solid #ef4444;
        }

        .integration-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 16px;
        }

        .integration-name {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            flex: 1;
        }

        .integration-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .integration-status.healthy {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .integration-status.degraded {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .integration-status.unhealthy {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .integration-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }

        .integration-metric {
            text-align: center;
        }

        .integration-metric-value {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }

        .integration-metric-label {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 4px;
        }

        .alerts-section {
            background: #1a1f26;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .alerts-header h2 {
            color: #ffffff;
            font-size: 20px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #111827;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid transparent;
        }

        .alert-item.critical {
            border-left-color: #ef4444;
        }

        .alert-item.high {
            border-left-color: #f59e0b;
        }

        .alert-item.medium {
            border-left-color: #3b82f6;
        }

        .alert-severity {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            min-width: 70px;
            text-align: center;
        }

        .alert-severity.critical {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .alert-severity.high {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .alert-severity.medium {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .alert-content {
            flex: 1;
        }

        .alert-message {
            color: #ffffff;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .alert-time {
            color: #9ca3af;
            font-size: 12px;
        }

        .alert-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #374151;
            color: #d1d5db;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: #1a1f26;
            border: 1px solid #2d3748;
            border-radius: 12px;
            padding: 24px;
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-title {
            color: #ffffff;
            font-size: 18px;
            font-weight: 600;
        }

        .chart-container {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111827;
            border-radius: 8px;
            color: #9ca3af;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #374151;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #6b7280;
            font-size: 14px;
            border-top: 1px solid #2d3748;
        }

        .tab-nav {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            background: #111827;
            padding: 4px;
            border-radius: 8px;
        }

        .tab-button {
            flex: 1;
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #9ca3af;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .tab-button.active {
            background: #3b82f6;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>
                🔍 Integration Monitor
            </h2>
            
            <div class="nav-section">
                <h3>Dashboard</h3>
                <a href="#overview" class="nav-item active" data-tab="overview">
                    📊 Overview
                </a>
                <a href="#integrations" class="nav-item" data-tab="integrations">
                    🔗 Integrations
                </a>
                <a href="#alerts" class="nav-item" data-tab="alerts">
                    🚨 Alerts
                </a>
                <a href="#metrics" class="nav-item" data-tab="metrics">
                    📈 Metrics
                </a>
            </div>
            
            <div class="nav-section">
                <h3>System</h3>
                <a href="#settings" class="nav-item" data-tab="settings">
                    ⚙️ Settings
                </a>
                <a href="#logs" class="nav-item" data-tab="logs">
                    📋 Logs
                </a>
                <a href="/docs" class="nav-item">
                    📚 API Docs
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>Integration Monitoring Dashboard</h1>
                <div class="header-controls">
                    <div class="status-indicator" id="connectionStatus">
                        <div class="pulse"></div>
                        <span>Connected</span>
                    </div>
                    <button class="btn btn-primary" onclick="refreshData()">
                        🔄 Refresh
                    </button>
                </div>
            </div>

            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content active">
                <!-- Metrics Grid -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Total Integrations</span>
                            <span class="metric-icon">🔗</span>
                        </div>
                        <div class="metric-value" id="totalIntegrations">--</div>
                        <div class="metric-subtitle">
                            <span id="activeIntegrations">--</span> active
                            <span class="metric-trend" id="integrationsTrend">+0%</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">System Health</span>
                            <span class="metric-icon">💚</span>
                        </div>
                        <div class="metric-value" id="systemHealth">--</div>
                        <div class="metric-subtitle">
                            Average uptime
                            <span class="metric-trend" id="healthTrend">+99.9%</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Response Time</span>
                            <span class="metric-icon">⚡</span>
                        </div>
                        <div class="metric-value" id="avgResponseTime">--</div>
                        <div class="metric-subtitle">
                            Average across all services
                            <span class="metric-trend" id="responseTrend">-12%</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Daily Cost</span>
                            <span class="metric-icon">💰</span>
                        </div>
                        <div class="metric-value" id="dailyCost">--</div>
                        <div class="metric-subtitle">
                            API usage costs today
                            <span class="metric-trend" id="costTrend">+5%</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Health Status Over Time</h3>
                        </div>
                        <div class="chart-container">
                            <div class="loading">
                                <div class="spinner"></div>
                                <span>Loading chart data...</span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Integration Status</h3>
                        </div>
                        <div class="chart-container">
                            <div id="statusDistribution">
                                <div style="text-align: center; color: #9ca3af;">
                                    <div style="font-size: 48px; margin-bottom: 16px;">📊</div>
                                    <div>Status distribution will appear here</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Integrations Grid -->
                <div id="integrationsGrid" class="integrations-grid">
                    <!-- Integration cards will be populated here -->
                </div>
            </div>

            <!-- Alerts Tab -->
            <div id="alerts-tab" class="tab-content">
                <div class="alerts-section">
                    <div class="alerts-header">
                        <h2>Active Alerts</h2>
                        <div class="header-controls">
                            <button class="btn btn-secondary">Clear All</button>
                        </div>
                    </div>
                    <div id="alertsList">
                        <!-- Alerts will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Integrations Tab -->
            <div id="integrations-tab" class="tab-content">
                <div class="tab-nav">
                    <button class="tab-button active" onclick="filterIntegrations('all')">All</button>
                    <button class="tab-button" onclick="filterIntegrations('payment')">Payment</button>
                    <button class="tab-button" onclick="filterIntegrations('marketing')">Marketing</button>
                    <button class="tab-button" onclick="filterIntegrations('ai')">AI Services</button>
                    <button class="tab-button" onclick="filterIntegrations('infrastructure')">Infrastructure</button>
                </div>
                <div id="integrationsList" class="integrations-grid">
                    <!-- Detailed integration list will be populated here -->
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p>BizOSaaS Integration Monitor v1.0.0 | Real-time monitoring for 40+ third-party integrations</p>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let websocket = null;
        let integrationsData = {};
        let metricsData = {};
        let alertsData = [];
        let currentFilter = 'all';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeWebSocket();
            initializeTabNavigation();
            loadInitialData();
            
            // Auto-refresh every 30 seconds
            setInterval(refreshData, 30000);
        });

        // WebSocket connection
        function initializeWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            websocket = new WebSocket(wsUrl);
            
            websocket.onopen = function() {
                updateConnectionStatus('connected');
                console.log('WebSocket connected');
            };
            
            websocket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };
            
            websocket.onclose = function() {
                updateConnectionStatus('disconnected');
                console.log('WebSocket disconnected');
                
                // Attempt to reconnect after 5 seconds
                setTimeout(initializeWebSocket, 5000);
            };
            
            websocket.onerror = function(error) {
                updateConnectionStatus('error');
                console.error('WebSocket error:', error);
            };
        }

        // Handle WebSocket messages
        function handleWebSocketMessage(data) {
            if (data.type === 'health_update') {
                integrationsData = data.data.integrations;
                metricsData = data.data.metrics;
                updateDashboard();
            } else if (data.type === 'alert_update') {
                alertsData.push(data.data);
                updateAlerts();
            }
        }

        // Update connection status
        function updateConnectionStatus(status) {
            const indicator = document.getElementById('connectionStatus');
            const pulse = indicator.querySelector('.pulse');
            const text = indicator.querySelector('span');
            
            indicator.className = 'status-indicator';
            
            switch(status) {
                case 'connected':
                    indicator.classList.add('connected');
                    text.textContent = 'Connected';
                    pulse.style.background = '#10b981';
                    break;
                case 'disconnected':
                    indicator.classList.add('warning');
                    text.textContent = 'Disconnected';
                    pulse.style.background = '#f59e0b';
                    break;
                case 'error':
                    indicator.classList.add('error');
                    text.textContent = 'Connection Error';
                    pulse.style.background = '#ef4444';
                    break;
            }
        }

        // Tab navigation
        function initializeTabNavigation() {
            document.querySelectorAll('.nav-item[data-tab]').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tab = this.dataset.tab;
                    switchTab(tab);
                });
            });
        }

        function switchTab(tabName) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Load initial data
        async function loadInitialData() {
            try {
                // Load integrations
                const integrationsResponse = await fetch('/integrations/health');
                if (integrationsResponse.ok) {
                    const integrationsResult = await integrationsResponse.json();
                    integrationsData = integrationsResult.data || {};
                }
                
                // Load metrics
                const metricsResponse = await fetch('/metrics/status');
                if (metricsResponse.ok) {
                    const metricsResult = await metricsResponse.json();
                    metricsData = metricsResult.data || {};
                }
                
                // Load alerts
                const alertsResponse = await fetch('/alerts/active');
                if (alertsResponse.ok) {
                    const alertsResult = await alertsResponse.json();
                    alertsData = alertsResult.data || [];
                }
                
                updateDashboard();
                
            } catch (error) {
                console.error('Failed to load initial data:', error);
                showMockData();
            }
        }

        // Show mock data for demonstration
        function showMockData() {
            integrationsData = {
                'stripe': {
                    name: 'stripe',
                    status: 'healthy',
                    response_time: 0.156,
                    error_rate: 0.001,
                    uptime: 0.9995,
                    health_score: 98.5,
                    cost_today: 15.75,
                    rate_limit_usage: 0.23
                },
                'paypal': {
                    name: 'paypal',
                    status: 'healthy',
                    response_time: 0.234,
                    error_rate: 0.002,
                    uptime: 0.999,
                    health_score: 96.8,
                    cost_today: 8.50,
                    rate_limit_usage: 0.15
                },
                'google_ads': {
                    name: 'google_ads',
                    status: 'degraded',
                    response_time: 1.856,
                    error_rate: 0.025,
                    uptime: 0.996,
                    health_score: 85.2,
                    cost_today: 45.20,
                    rate_limit_usage: 0.78
                },
                'openai': {
                    name: 'openai',
                    status: 'healthy',
                    response_time: 2.145,
                    error_rate: 0.005,
                    uptime: 0.998,
                    health_score: 94.1,
                    cost_today: 28.90,
                    rate_limit_usage: 0.42
                },
                'aws_s3': {
                    name: 'aws_s3',
                    status: 'unhealthy',
                    response_time: 5.234,
                    error_rate: 0.085,
                    uptime: 0.992,
                    health_score: 65.8,
                    cost_today: 12.30,
                    rate_limit_usage: 0.95
                }
            };
            
            metricsData = {
                total_integrations: 24,
                healthy_count: 18,
                degraded_count: 4,
                unhealthy_count: 2,
                average_response_time: 1.532,
                total_error_rate: 0.015,
                average_uptime: 0.997,
                cost_today: 142.85
            };
            
            alertsData = [
                {
                    id: 'alert_1',
                    severity: 'critical',
                    title: 'AWS S3 Service Degradation',
                    message: 'High error rate detected on AWS S3 operations',
                    created_at: new Date().toISOString(),
                    integration_name: 'aws_s3'
                },
                {
                    id: 'alert_2',
                    severity: 'high',
                    title: 'Google Ads API Slow Response',
                    message: 'Response time exceeding 2 seconds for Google Ads API',
                    created_at: new Date(Date.now() - 300000).toISOString(),
                    integration_name: 'google_ads'
                }
            ];
            
            updateDashboard();
        }

        // Update dashboard with new data
        function updateDashboard() {
            updateMetrics();
            updateIntegrationsGrid();
            updateAlerts();
        }

        // Update metrics display
        function updateMetrics() {
            if (!metricsData) return;
            
            document.getElementById('totalIntegrations').textContent = metricsData.total_integrations || '--';
            document.getElementById('activeIntegrations').textContent = metricsData.healthy_count || '--';
            document.getElementById('systemHealth').textContent = 
                metricsData.average_uptime ? `${(metricsData.average_uptime * 100).toFixed(2)}%` : '--';
            document.getElementById('avgResponseTime').textContent = 
                metricsData.average_response_time ? `${(metricsData.average_response_time * 1000).toFixed(0)}ms` : '--';
            document.getElementById('dailyCost').textContent = 
                metricsData.cost_today ? `$${metricsData.cost_today.toFixed(2)}` : '--';
        }

        // Update integrations grid
        function updateIntegrationsGrid() {
            const grid = document.getElementById('integrationsGrid');
            if (!grid || !integrationsData) return;
            
            const integrations = Object.values(integrationsData);
            let filteredIntegrations = integrations;
            
            if (currentFilter !== 'all') {
                filteredIntegrations = integrations.filter(integration => {
                    return getIntegrationCategory(integration.name) === currentFilter;
                });
            }
            
            grid.innerHTML = filteredIntegrations.map(integration => createIntegrationCard(integration)).join('');
        }

        // Create integration card HTML
        function createIntegrationCard(integration) {
            const statusClass = integration.status || 'unknown';
            const displayName = getIntegrationDisplayName(integration.name);
            const category = getIntegrationCategory(integration.name);
            
            return `
                <div class="integration-card ${statusClass}">
                    <div class="integration-header">
                        <div class="integration-name">${displayName}</div>
                        <div class="integration-status ${statusClass}">${statusClass}</div>
                    </div>
                    <div class="integration-metrics">
                        <div class="integration-metric">
                            <div class="integration-metric-value">${(integration.response_time * 1000 || 0).toFixed(0)}ms</div>
                            <div class="integration-metric-label">Response Time</div>
                        </div>
                        <div class="integration-metric">
                            <div class="integration-metric-value">${((integration.uptime || 0) * 100).toFixed(2)}%</div>
                            <div class="integration-metric-label">Uptime</div>
                        </div>
                        <div class="integration-metric">
                            <div class="integration-metric-value">${(integration.health_score || 0).toFixed(1)}</div>
                            <div class="integration-metric-label">Health Score</div>
                        </div>
                        <div class="integration-metric">
                            <div class="integration-metric-value">$${(integration.cost_today || 0).toFixed(2)}</div>
                            <div class="integration-metric-label">Cost Today</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Update alerts display
        function updateAlerts() {
            const alertsList = document.getElementById('alertsList');
            if (!alertsList) return;
            
            if (alertsData.length === 0) {
                alertsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #9ca3af;">
                        <div style="font-size: 48px; margin-bottom: 16px;">✅</div>
                        <div>No active alerts</div>
                    </div>
                `;
                return;
            }
            
            alertsList.innerHTML = alertsData.map(alert => createAlertItem(alert)).join('');
        }

        // Create alert item HTML
        function createAlertItem(alert) {
            const timeAgo = getTimeAgo(new Date(alert.created_at));
            
            return `
                <div class="alert-item ${alert.severity}">
                    <div class="alert-severity ${alert.severity}">${alert.severity}</div>
                    <div class="alert-content">
                        <div class="alert-message">${alert.title || alert.message}</div>
                        <div class="alert-time">${timeAgo} • ${alert.integration_name || 'System'}</div>
                    </div>
                    <div class="alert-actions">
                        <button class="btn btn-primary" onclick="acknowledgeAlert('${alert.id}')">Acknowledge</button>
                        <button class="btn btn-secondary" onclick="resolveAlert('${alert.id}')">Resolve</button>
                    </div>
                </div>
            `;
        }

        // Utility functions
        function getIntegrationDisplayName(name) {
            const displayNames = {
                'stripe': 'Stripe',
                'paypal': 'PayPal',
                'google_ads': 'Google Ads',
                'facebook_ads': 'Facebook Ads',
                'openai': 'OpenAI',
                'anthropic': 'Anthropic',
                'aws_s3': 'AWS S3',
                'cloudflare': 'CloudFlare'
            };
            return displayNames[name] || name.charAt(0).toUpperCase() + name.slice(1);
        }

        function getIntegrationCategory(name) {
            const categories = {
                'stripe': 'payment',
                'paypal': 'payment',
                'razorpay': 'payment',
                'google_ads': 'marketing',
                'facebook_ads': 'marketing',
                'linkedin_marketing': 'marketing',
                'openai': 'ai',
                'anthropic': 'ai',
                'synthesia': 'ai',
                'aws_s3': 'infrastructure',
                'cloudflare': 'infrastructure'
            };
            return categories[name] || 'other';
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours}h ago`;
            
            const diffDays = Math.floor(diffHours / 24);
            return `${diffDays}d ago`;
        }

        // Action functions
        function refreshData() {
            loadInitialData();
        }

        function filterIntegrations(category) {
            currentFilter = category;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateIntegrationsGrid();
        }

        function acknowledgeAlert(alertId) {
            fetch(`/alerts/${alertId}/acknowledge`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alertsData = alertsData.filter(alert => alert.id !== alertId);
                        updateAlerts();
                    }
                })
                .catch(error => console.error('Failed to acknowledge alert:', error));
        }

        function resolveAlert(alertId) {
            fetch(`/alerts/${alertId}/resolve`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alertsData = alertsData.filter(alert => alert.id !== alertId);
                        updateAlerts();
                    }
                })
                .catch(error => console.error('Failed to resolve alert:', error));
        }
    </script>
</body>
</html>