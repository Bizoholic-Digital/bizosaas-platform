<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-store text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">{{ service_name }}</h1>
                        <p class="text-blue-100">AI-Powered E-commerce Intelligence</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="bg-green-500 px-3 py-1 rounded-full text-sm">Port {{ port }}</span>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-sm">Live</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8" x-data="commerceDashboard()">
        <!-- Overview Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Total Products</p>
                        <p class="text-3xl font-bold text-gray-800" x-text="overview.total_products">1,247</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-box text-blue-600 text-xl"></i>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-green-600 text-sm">
                        <i class="fas fa-arrow-up"></i> 12% from last month
                    </span>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Revenue (30d)</p>
                        <p class="text-3xl font-bold text-gray-800" x-text="formatCurrency(overview.total_revenue)">₹2,45,680</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-rupee-sign text-green-600 text-xl"></i>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-green-600 text-sm">
                        <i class="fas fa-arrow-up"></i> 18% from last month
                    </span>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Avg Order Value</p>
                        <p class="text-3xl font-bold text-gray-800" x-text="formatCurrency(overview.avg_order_value)">₹1,856</p>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-red-600 text-sm">
                        <i class="fas fa-arrow-down"></i> 3% from last month
                    </span>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm">Conversion Rate</p>
                        <p class="text-3xl font-bold text-gray-800" x-text="overview.conversion_rate + '%'">3.2%</p>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fas fa-percentage text-orange-600 text-xl"></i>
                    </div>
                </div>
                <div class="mt-4">
                    <span class="text-green-600 text-sm">
                        <i class="fas fa-arrow-up"></i> 0.5% from last month
                    </span>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-8">
                <!-- AI Recommendations -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-robot text-blue-600 mr-2"></i>
                        AI Recommendations
                    </h3>
                    <div class="space-y-4">
                        <template x-for="recommendation in recommendations" :key="recommendation.id">
                            <div class="border-l-4 border-blue-500 bg-blue-50 p-4 rounded-r-lg">
                                <div class="flex items-start justify-between">
                                    <div>
                                        <p class="font-semibold text-gray-800" x-text="recommendation.title"></p>
                                        <p class="text-gray-600 text-sm mt-1" x-text="recommendation.description"></p>
                                        <div class="mt-2">
                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs" 
                                                  x-text="recommendation.category"></span>
                                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs ml-2" 
                                                  x-text="'Impact: ' + recommendation.impact"></span>
                                        </div>
                                    </div>
                                    <button class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                        Apply
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Performance Charts -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">Revenue & Orders Trend</h3>
                    <div id="performance-chart" class="h-80"></div>
                </div>

                <!-- Top Products -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">Top Performing Products</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="text-left p-3">Product</th>
                                    <th class="text-left p-3">Revenue</th>
                                    <th class="text-left p-3">Units Sold</th>
                                    <th class="text-left p-3">Conversion</th>
                                    <th class="text-left p-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="product in topProducts" :key="product.id">
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="p-3">
                                            <div class="font-semibold" x-text="product.name"></div>
                                            <div class="text-gray-500 text-xs" x-text="product.sku"></div>
                                        </td>
                                        <td class="p-3 font-semibold" x-text="formatCurrency(product.revenue)"></td>
                                        <td class="p-3" x-text="product.units_sold"></td>
                                        <td class="p-3">
                                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs" 
                                                  x-text="product.conversion_rate + '%'"></span>
                                        </td>
                                        <td class="p-3">
                                            <button class="text-blue-600 hover:text-blue-800 mr-2">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="text-green-600 hover:text-green-800">
                                                <i class="fas fa-chart-line"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-8">
                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <button @click="optimizeProducts()" 
                                class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
                            <i class="fas fa-magic mr-2"></i>
                            Optimize Product Catalog
                        </button>
                        <button @click="forecastInventory()" 
                                class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition">
                            <i class="fas fa-chart-bar mr-2"></i>
                            Forecast Inventory
                        </button>
                        <button @click="analyzePricing()" 
                                class="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700 transition">
                            <i class="fas fa-tags mr-2"></i>
                            Analyze Pricing
                        </button>
                        <button @click="analyzeCustomers()" 
                                class="w-full bg-orange-600 text-white py-2 rounded hover:bg-orange-700 transition">
                            <i class="fas fa-users mr-2"></i>
                            Analyze Customers
                        </button>
                    </div>
                </div>

                <!-- Inventory Alerts -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4 text-red-600">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Inventory Alerts
                    </h3>
                    <div class="space-y-3">
                        <template x-for="alert in inventoryAlerts" :key="alert.id">
                            <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                                <div>
                                    <p class="font-semibold text-sm" x-text="alert.product_name"></p>
                                    <p class="text-red-600 text-xs" x-text="alert.message"></p>
                                </div>
                                <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs" 
                                      x-text="alert.alert_type"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Market Insights -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">
                        <i class="fas fa-globe mr-2"></i>
                        Market Insights
                    </h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="font-semibold text-sm text-blue-800">Trending Categories</p>
                            <p class="text-blue-600 text-xs">Electronics, Home & Garden, Health & Beauty</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <p class="font-semibold text-sm text-green-800">Market Growth</p>
                            <p class="text-green-600 text-xs">15.2% growth in Indian e-commerce</p>
                        </div>
                        <div class="bg-orange-50 p-3 rounded-lg">
                            <p class="font-semibold text-sm text-orange-800">Seasonal Trends</p>
                            <p class="text-orange-600 text-xs">Festive season demand increasing</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div x-show="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md mx-4">
            <div class="text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold">Processing AI Analysis...</h3>
                <p class="text-gray-600 mt-2" x-text="loadingMessage"></p>
            </div>
        </div>
    </div>

    <script>
        function commerceDashboard() {
            return {
                loading: false,
                loadingMessage: 'Analyzing your data...',
                overview: {
                    total_products: 1247,
                    total_revenue: 245680,
                    avg_order_value: 1856,
                    conversion_rate: 3.2
                },
                recommendations: [
                    {
                        id: 1,
                        title: 'Optimize Product Listings',
                        description: '15 products have low conversion rates. Improve descriptions and images.',
                        category: 'Product Optimization',
                        impact: 'High'
                    },
                    {
                        id: 2,
                        title: 'Dynamic Pricing Opportunity',
                        description: '8 products can increase prices by 12-15% based on demand.',
                        category: 'Pricing',
                        impact: 'Medium'
                    },
                    {
                        id: 3,
                        title: 'Inventory Reorder Alert',
                        description: '23 products will run out of stock in next 7 days.',
                        category: 'Inventory',
                        impact: 'Critical'
                    }
                ],
                topProducts: [
                    {
                        id: 1,
                        name: 'Premium Wireless Headphones',
                        sku: 'SKU001',
                        revenue: 89500,
                        units_sold: 145,
                        conversion_rate: 4.2
                    },
                    {
                        id: 2,
                        name: 'Smart Fitness Watch',
                        sku: 'SKU002',
                        revenue: 67400,
                        units_sold: 98,
                        conversion_rate: 3.8
                    },
                    {
                        id: 3,
                        name: 'Organic Cotton T-Shirt',
                        sku: 'SKU003',
                        revenue: 45200,
                        units_sold: 234,
                        conversion_rate: 5.1
                    }
                ],
                inventoryAlerts: [
                    {
                        id: 1,
                        product_name: 'Smart Fitness Watch',
                        message: 'Only 5 units left',
                        alert_type: 'Critical'
                    },
                    {
                        id: 2,
                        product_name: 'LED Desk Lamp',
                        message: 'Stock level: 8 units',
                        alert_type: 'Low Stock'
                    }
                ],

                init() {
                    this.loadDashboardData();
                    this.createPerformanceChart();
                },

                async loadDashboardData() {
                    try {
                        const response = await fetch('/api/v1/dashboard/commerce?tenant_id=demo&date_range=30d');
                        const data = await response.json();
                        if (data.success) {
                            this.overview = data.dashboard.overview;
                            this.topProducts = data.dashboard.top_products || this.topProducts;
                            this.inventoryAlerts = data.dashboard.inventory_alerts || this.inventoryAlerts;
                        }
                    } catch (error) {
                        console.error('Error loading dashboard data:', error);
                    }
                },

                createPerformanceChart() {
                    const trace1 = {
                        x: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        y: [45000, 52000, 48000, 61000],
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Revenue',
                        yaxis: 'y',
                        line: { color: '#3B82F6' }
                    };

                    const trace2 = {
                        x: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        y: [285, 325, 298, 342],
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Orders',
                        yaxis: 'y2',
                        line: { color: '#10B981' }
                    };

                    const layout = {
                        title: '',
                        xaxis: { title: 'Time Period' },
                        yaxis: {
                            title: 'Revenue (₹)',
                            titlefont: { color: '#3B82F6' },
                            tickfont: { color: '#3B82F6' }
                        },
                        yaxis2: {
                            title: 'Orders',
                            titlefont: { color: '#10B981' },
                            tickfont: { color: '#10B981' },
                            overlaying: 'y',
                            side: 'right'
                        },
                        legend: { x: 0, y: 1 },
                        margin: { l: 50, r: 50, t: 30, b: 50 }
                    };

                    Plotly.newPlot('performance-chart', [trace1, trace2], layout, {responsive: true});
                },

                formatCurrency(amount) {
                    return new Intl.NumberFormat('en-IN', {
                        style: 'currency',
                        currency: 'INR'
                    }).format(amount);
                },

                async optimizeProducts() {
                    this.loading = true;
                    this.loadingMessage = 'Analyzing product performance and generating optimization recommendations...';
                    
                    try {
                        const response = await fetch('/api/v1/products/optimize', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                tenant_id: 'demo',
                                optimization_goals: ['revenue', 'profit', 'conversion'],
                                time_period: '30d'
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            alert('Product optimization completed! Check the recommendations panel for details.');
                        }
                    } catch (error) {
                        console.error('Error optimizing products:', error);
                        alert('Error occurred while optimizing products. Please try again.');
                    } finally {
                        this.loading = false;
                    }
                },

                async forecastInventory() {
                    this.loading = true;
                    this.loadingMessage = 'Forecasting inventory demand using AI models...';
                    
                    try {
                        const response = await fetch('/api/v1/inventory/forecast', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                tenant_id: 'demo',
                                forecast_period: 30,
                                reorder_strategy: 'auto'
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            alert('Inventory forecast completed! Demand predictions and reorder recommendations are ready.');
                        }
                    } catch (error) {
                        console.error('Error forecasting inventory:', error);
                        alert('Error occurred while forecasting inventory. Please try again.');
                    } finally {
                        this.loading = false;
                    }
                },

                async analyzePricing() {
                    this.loading = true;
                    this.loadingMessage = 'Analyzing market pricing and generating dynamic pricing recommendations...';
                    
                    try {
                        const response = await fetch('/api/v1/pricing/optimize', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                tenant_id: 'demo',
                                product_ids: ['product1', 'product2', 'product3'],
                                strategy: 'dynamic',
                                competitor_analysis: true
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            alert('Pricing analysis completed! Strategic pricing recommendations are available.');
                        }
                    } catch (error) {
                        console.error('Error analyzing pricing:', error);
                        alert('Error occurred while analyzing pricing. Please try again.');
                    } finally {
                        this.loading = false;
                    }
                },

                async analyzeCustomers() {
                    this.loading = true;
                    this.loadingMessage = 'Analyzing customer behavior and generating insights...';
                    
                    try {
                        const response = await fetch('/api/v1/customers/analyze', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                tenant_id: 'demo',
                                date_range: {
                                    start: '2024-08-01',
                                    end: '2024-09-01'
                                },
                                analysis_type: 'comprehensive'
                            })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            alert('Customer analysis completed! Behavioral insights and segmentation are ready.');
                        }
                    } catch (error) {
                        console.error('Error analyzing customers:', error);
                        alert('Error occurred while analyzing customers. Please try again.');
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }
    </script>
</body>
</html>