services:
  # Postiz App
  postiz-app:
    image: ghcr.io/gitroomhq/postiz-app:latest
    container_name: postiz-app
    restart: always
    environment:
      # Database & Redis (Externalized to Neon / Redis Cloud)
      - DATABASE_URL=${POSTIZ_DATABASE_URL}
      - REDIS_URL=${REDIS_URL}

      # Security
      - JWT_SECRET=${POSTIZ_JWT_SECRET:-iyQ+Z0egmGAHdkBEsGPe5+u78WcDj0OWniocepqvQvc=}

      # URLs
      - MAIN_URL=https://postiz.bizoholic.net
      - FRONTEND_URL=https://postiz.bizoholic.net
      - NEXT_PUBLIC_BACKEND_URL=https://postiz.bizoholic.net/api
      - BACKEND_INTERNAL_URL=http://localhost:3000

      # Temporal (Externalized to Temporal Cloud)
      - TEMPORAL_ADDRESS=${TEMPORAL_ADDRESS}
      - TEMPORAL_NAMESPACE=${TEMPORAL_NAMESPACE}
      - TEMPORAL_API_KEY=${TEMPORAL_API_KEY}

      # General
      - IS_GENERAL_INSTANCE=true
      - STORAGE_PROVIDER=local
      - UPLOAD_DIRECTORY=/uploads
      - NEXT_PUBLIC_UPLOAD_DIRECTORY=/uploads

      # AI Integration
      - OPENAI_API_KEY=${OPENAI_API_KEY}

      # Authentik SSO Configuration
      - POSTIZ_GENERIC_OAUTH=true
      - CLIENT_ID=${POSTIZ_AUTHENTIK_CLIENT_ID}
      - CLIENT_SECRET=${POSTIZ_AUTHENTIK_CLIENT_SECRET}
      - POSTIZ_OAUTH_URL=https://auth.bizoholic.net/application/o/authorize/
      - POSTIZ_OAUTH_AUTH_URL=https://auth.bizoholic.net/application/o/authorize/
      - POSTIZ_OAUTH_TOKEN_URL=https://auth.bizoholic.net/application/o/token/
      - POSTIZ_OAUTH_USERINFO_URL=https://auth.bizoholic.net/application/o/userinfo/
      - NEXT_PUBLIC_POSTIZ_OAUTH_DISPLAY_NAME=Login with BizOSaas
      - NEXT_PUBLIC_POSTIZ_OAUTH_LOGO_URL=https://bizoholic.net/assets/logo.png
    volumes:
      - postiz-uploads:/uploads
    networks:
      - dokploy-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.postiz.rule=Host(`postiz.bizoholic.net`)"
      - "traefik.http.routers.postiz.entrypoints=websecure"
      - "traefik.http.routers.postiz.tls=true"
      - "traefik.http.routers.postiz.tls.certresolver=letsencrypt"
      - "traefik.http.services.postiz.loadbalancer.server.port=5000"
      - "traefik.docker.network=dokploy-network"

volumes:
  postiz-uploads:


networks:
  dokploy-network:
    external: true
