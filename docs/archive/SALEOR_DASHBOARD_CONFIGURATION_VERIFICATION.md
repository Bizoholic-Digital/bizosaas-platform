# Saleor Dashboard Configuration Verification Checklist

**Date:** November 3, 2025
**VPS:** KVM4 (72.60.219.244)
**Dokploy Project:** CoreLdove
**Service Name:** saleor-dashboard

## Current Infrastructure Status

### Existing Services on KVM4

✅ **Saleor API (Backend)**
- Container: `backend-saleor-api.1.2b4cetxidpwq0i5l3nbgmi10p`
- Image: `ghcr.io/saleor/saleor:3.20`
- Status: Running (Up 6 days)
- Internal IP: `10.0.1.47`
- Port: `8000/tcp`

❌ **Saleor Dashboard (Frontend)**
- Status: NOT DEPLOYED YET
- Needs deployment via Dokploy UI

---

## Dokploy Configuration Checklist

### ✅ VERIFIED: Correct Configuration

Please verify your Dokploy configuration matches these exact settings:

### 1. General Tab
```yaml
Service Name: saleor-dashboard
Service Type: Docker Image
Project: coreldove  # ⚠️ IMPORTANT: Must be "coreldove" not "frontend"
```

**⚠️ CRITICAL CHECK:** You mentioned "frontend project" - Saleor Dashboard should be in the **"coreldove"** project, not just "frontend". Please verify this in Dokploy UI.

### 2. Image Tab
```yaml
Image: ghcr.io/saleor/saleor-dashboard:latest
Registry: Public (no authentication needed)
Pull Policy: Always
```

### 3. Network → Ports Tab
```yaml
Published Port: 9000
Container Port: 80
Protocol: TCP
Publish: ✅ Enabled
```

**Explanation:**
- **Container Port = 80**: Nginx inside the official Saleor Dashboard image (cannot be changed)
- **Published Port = 9000**: External port on KVM4 server (chosen as it's available)

### 4. Environment Tab

**CRITICAL - Correct API URL:**
```yaml
API_URL=http://10.0.1.47:8000/graphql/
```

**❌ WRONG:**
```
API_URL=http://172.31.0.1:8000/graphql/  # ← This is WRONG IP
API_URL=http://localhost:8000/graphql/   # ← This won't work
```

**✅ CORRECT:**
```
API_URL=http://10.0.1.47:8000/graphql/  # ← Use this EXACT value
```

**Why 10.0.1.47?**
- This is the internal Docker network IP of the Saleor API container
- Verified via: `docker inspect backend-saleor-api.1.2b4cetxidpwq0i5l3nbgmi10p`
- Dashboard needs to connect to this internal IP

### 5. Routing → Domain Tab

**Domain Configuration:**
```yaml
Host: stg.coreldove.com
Path: /dashboard
Container Port: 80
HTTPS: ✅ Enabled
Certificate Resolver: letsencrypt
```

**Traefik Labels (Auto-generated by Dokploy):**
```yaml
traefik.enable=true
traefik.http.routers.saleor-dashboard.rule=Host(`stg.coreldove.com`) && PathPrefix(`/dashboard`)
traefik.http.routers.saleor-dashboard.entrypoints=websecure
traefik.http.routers.saleor-dashboard.tls=true
traefik.http.routers.saleor-dashboard.tls.certresolver=letsencrypt
traefik.http.services.saleor-dashboard.loadbalancer.server.port=80

# Strip /dashboard prefix middleware
traefik.http.middlewares.saleor-dashboard-stripprefix.stripprefix.prefixes=/dashboard
traefik.http.routers.saleor-dashboard.middlewares=saleor-dashboard-stripprefix
```

### 6. Resources Tab
```yaml
CPU Limit: 0.5 cores
Memory Limit: 512 MB
Memory Reservation: 256 MB
```

**Rationale:** Static React SPA served by Nginx - very lightweight resource requirements

### 7. Health Check Tab
```yaml
Test Command: CMD curl -f http://localhost:80/ || exit 1
Interval: 30s
Timeout: 10s
Retries: 3
Start Period: 40s
```

---

## Deployment Verification Steps

### Before Deployment

- [ ] 1. Verify project is "coreldove" (not just "frontend")
- [ ] 2. Confirm API_URL is `http://10.0.1.47:8000/graphql/`
- [ ] 3. Check domain is `stg.coreldove.com`
- [ ] 4. Verify path is `/dashboard`
- [ ] 5. Ensure container port is 80
- [ ] 6. Confirm published port is 9000

### Click "Deploy" Button in Dokploy

Dokploy will:
1. Pull `ghcr.io/saleor/saleor-dashboard:latest`
2. Create container with environment variables
3. Configure Traefik routing
4. Start health checks

### After Deployment (Verification)

#### 1. Check Container Status
```bash
# SSH to KVM4
ssh root@72.60.219.244

# Check saleor-dashboard container
docker ps | grep saleor-dashboard

# Expected output:
# [container_id]   ghcr.io/saleor/saleor-dashboard:latest   Up X minutes   80/tcp
```

#### 2. Verify Direct Container Access
```bash
# Test HTTP response from container
curl -I http://localhost:9000/

# Expected: HTTP/1.1 200 OK
```

#### 3. Test Traefik Domain Routing
```bash
# From your local machine
curl -I https://stg.coreldove.com/dashboard/

# Expected: HTTP/2 200
# Should redirect to HTTPS and return dashboard
```

#### 4. Browser Test
1. Open: `https://stg.coreldove.com/dashboard/`
2. Should see Saleor Dashboard login page
3. Check browser console for errors
4. Verify CSS/JS assets load correctly

#### 5. Test API Connection
1. Try to login with Saleor admin credentials
2. Dashboard should connect to `http://10.0.1.47:8000/graphql/`
3. Open browser DevTools → Network tab
4. Should see GraphQL requests to `/graphql/`
5. Requests should return 200 OK (if authenticated)

#### 6. Verify Logs
```bash
# View dashboard logs
docker logs [saleor-dashboard-container-id]

# Look for:
# - Nginx startup messages
# - No error logs
# - Access logs when navigating dashboard
```

---

## Common Configuration Errors to Avoid

### ❌ Error 1: Wrong Project
```
Project: frontend  # WRONG
Project: Frontend Services  # WRONG
```
✅ **Correct:** `Project: coreldove`

### ❌ Error 2: Wrong API_URL
```
API_URL=http://172.31.0.1:8000/graphql/  # WRONG IP
API_URL=http://localhost:8000/graphql/   # Won't work
API_URL=http://saleor-api:8000/graphql/  # Container name won't resolve
```
✅ **Correct:** `API_URL=http://10.0.1.47:8000/graphql/`

### ❌ Error 3: Wrong Port Configuration
```
Container Port: 9000  # WRONG - can't change official image port
Published Port: 80    # WRONG - conflicts with other services
```
✅ **Correct:** `Container Port: 80, Published Port: 9000`

### ❌ Error 4: Missing Strip Prefix Middleware
```
Path: /dashboard
# But no stripprefix middleware configured
```
Result: Assets return 404 because paths have `/dashboard` prefix

✅ **Correct:** Dokploy should auto-configure stripprefix middleware

### ❌ Error 5: CORS Not Configured
Saleor Core must allow dashboard domain:
```bash
# In Saleor Core environment variables:
ALLOWED_CLIENT_HOSTS=stg.coreldove.com,localhost
```

---

## Troubleshooting Guide

### Issue: Container Won't Start

**Check logs:**
```bash
docker logs [container_id]
```

**Common causes:**
- Port 9000 already in use → Change published port
- Image pull failed → Check internet connectivity
- Wrong image name → Verify `ghcr.io/saleor/saleor-dashboard:latest`

### Issue: 502 Bad Gateway

**Diagnosis:**
```bash
# 1. Check container is running
docker ps | grep saleor-dashboard

# 2. Check Traefik can reach container
docker logs traefik 2>&1 | grep saleor-dashboard

# 3. Test direct access
curl http://localhost:9000/
```

**Common causes:**
- Container not running
- Wrong Traefik routing
- Health check failing

### Issue: Dashboard Loads but Can't Login

**Diagnosis:**
1. Open browser DevTools → Console
2. Look for CORS errors
3. Check Network tab for failed GraphQL requests

**Common causes:**
- Wrong `API_URL` environment variable
- CORS not configured in Saleor Core
- Saleor API not accessible from browser

**Fix:**
1. Verify API_URL is `http://10.0.1.47:8000/graphql/`
2. Add `ALLOWED_CLIENT_HOSTS=stg.coreldove.com` to Saleor Core
3. Restart Saleor Core container

### Issue: Static Assets 404

**Symptoms:** Dashboard page loads but CSS/JS return 404

**Diagnosis:**
```bash
# Check Nginx access logs
docker logs [saleor-dashboard-container-id] 2>&1 | tail -50

# Test asset path
curl -I https://stg.coreldove.com/dashboard/static/css/main.css
```

**Common causes:**
- Strip prefix middleware not applied
- Wrong base path configuration

**Fix:**
Verify Traefik middleware is configured:
```yaml
traefik.http.middlewares.saleor-dashboard-stripprefix.stripprefix.prefixes=/dashboard
traefik.http.routers.saleor-dashboard.middlewares=saleor-dashboard-stripprefix
```

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                         USER BROWSER                             │
│                              ↓                                   │
│                     HTTPS (Port 443)                             │
└─────────────────────────────────────────────────────────────────┘
                               ↓
┌─────────────────────────────────────────────────────────────────┐
│                   TRAEFIK (Reverse Proxy)                        │
│                                                                   │
│  Rule: Host(stg.coreldove.com) && PathPrefix(/dashboard)       │
│  Middleware: Strip /dashboard prefix                            │
│  SSL: Let's Encrypt                                             │
└─────────────────────────────────────────────────────────────────┘
                               ↓
┌─────────────────────────────────────────────────────────────────┐
│              SALEOR DASHBOARD (Port 9000 → 80)                  │
│                                                                   │
│  Image: ghcr.io/saleor/saleor-dashboard:latest                 │
│  Type: React SPA served by Nginx                                │
│  Environment: API_URL=http://10.0.1.47:8000/graphql/           │
└─────────────────────────────────────────────────────────────────┘
                               ↓
                    GraphQL API Calls
                    (From User Browser)
                               ↓
┌─────────────────────────────────────────────────────────────────┐
│                SALEOR CORE API (Port 8000)                       │
│                                                                   │
│  Internal IP: 10.0.1.47                                         │
│  Image: ghcr.io/saleor/saleor:3.20                              │
│  GraphQL Endpoint: /graphql/                                    │
└─────────────────────────────────────────────────────────────────┘
                               ↓
┌─────────────────────────────────────────────────────────────────┐
│                   SALEOR POSTGRESQL                              │
│                                                                   │
│  Host: infrastructureservices-saleorpostgres-las0jw            │
│  Port: 5432                                                     │
└─────────────────────────────────────────────────────────────────┘
```

**Important Notes:**
1. Dashboard is a **client-side React SPA** - runs in user's browser
2. GraphQL API calls go directly from browser → Saleor Core API
3. Not proxied through Brain Gateway (unlike other frontends)
4. API_URL must be accessible from user's browser (10.0.1.47 is internal)

---

## Security Considerations

### 1. HTTPS Only
- All external access via HTTPS (Traefik handles SSL)
- Traefik automatically redirects HTTP → HTTPS
- Let's Encrypt certificates auto-renewed

### 2. CORS Configuration Required
Saleor Core must whitelist dashboard domain:
```bash
# In Saleor Core environment variables:
ALLOWED_CLIENT_HOSTS=stg.coreldove.com,localhost
```

### 3. Authentication
- Dashboard uses Saleor Core's built-in JWT authentication
- No separate auth system needed
- Login handled by Saleor GraphQL API

### 4. API Access
- GraphQL API must be publicly accessible (for browser)
- Consider rate limiting on Traefik
- Monitor for unauthorized API access

---

## Final Pre-Deployment Checklist

Before clicking "Deploy" in Dokploy UI, verify:

- [ ] Project is **coreldove** (not "frontend")
- [ ] Image is `ghcr.io/saleor/saleor-dashboard:latest`
- [ ] Container Port is **80**
- [ ] Published Port is **9000**
- [ ] API_URL is `http://10.0.1.47:8000/graphql/`
- [ ] Domain Host is `stg.coreldove.com`
- [ ] Domain Path is `/dashboard`
- [ ] HTTPS is **Enabled**
- [ ] Certificate Resolver is **letsencrypt**
- [ ] CPU Limit is 0.5 cores
- [ ] Memory Limit is 512 MB
- [ ] Health check command is `CMD curl -f http://localhost:80/ || exit 1`

---

## After Successful Deployment

Once deployed successfully:

1. ✅ Container running and healthy
2. ✅ Direct access works: `http://72.60.219.244:9000/`
3. ✅ Domain access works: `https://stg.coreldove.com/dashboard/`
4. ✅ Dashboard login page loads with all assets
5. ✅ Can login with Saleor admin credentials
6. ✅ Dashboard can query and display store data
7. ✅ No CORS errors in browser console

→ **Proceed to Webhook CrewAI Integration** (see next document)

---

**Configuration Status:** Pending Deployment
**Next Step:** Click "Deploy" in Dokploy UI after verification
**Document:** Configuration Verification Complete
