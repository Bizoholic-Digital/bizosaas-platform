<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizOSaaS Dashboard - Autonomous AI Agents</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1a202c;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }
        
        .sidebar-subtitle {
            font-size: 0.875rem;
            color: #718096;
        }
        
        .nav-menu {
            padding: 1rem 0;
        }
        
        .nav-section {
            margin-bottom: 1.5rem;
        }
        
        .nav-section-title {
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: #4a5568;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #edf2f7;
            color: #2b6cb0;
            border-right: 3px solid #3182ce;
        }
        
        .nav-item-icon {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .top-bar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            display: flex;
            justify-content: between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .top-bar-left {
            display: flex;
            align-items: center;
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            margin-right: 1rem;
        }
        
        .tier-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .tier-1 {
            background: #e6fffa;
            color: #00695c;
        }
        
        .tier-2 {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .tier-3 {
            background: #fef3e2;
            color: #c05621;
        }
        
        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: auto;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #2d3748;
        }
        
        .card-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-offline {
            background: #ef4444;
        }
        
        .status-warning {
            background: #f59e0b;
        }
        
        .card-metric {
            font-size: 2rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }
        
        .card-description {
            color: #718096;
            font-size: 0.875rem;
        }
        
        .service-list {
            display: grid;
            gap: 0.75rem;
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f7fafc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .service-item:hover {
            background: #edf2f7;
            transform: translateX(2px);
        }
        
        .service-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .service-name {
            font-weight: 500;
            color: #2d3748;
        }
        
        .service-url {
            font-size: 0.75rem;
            color: #718096;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .agent-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }
        
        .agent-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .agent-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }
        
        .agent-description {
            font-size: 0.875rem;
            color: #718096;
            margin-bottom: 0.75rem;
        }
        
        .agent-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            color: #718096;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f4f6;
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">BizOSaaS</div>
                <div class="sidebar-subtitle">AI Agents Platform</div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <div class="nav-item active" data-section="overview">
                        <span class="nav-item-text">Overview</span>
                    </div>
                    <div class="nav-item" data-section="agents">
                        <span class="nav-item-text">AI Agents</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Platform Services</div>
                    <div class="nav-item" data-section="wagtail">
                        <span class="nav-item-text">CMS (Wagtail)</span>
                    </div>
                    <div class="nav-item" data-section="saleor">
                        <span class="nav-item-text">E-commerce (Saleor)</span>
                    </div>
                    <div class="nav-item" data-section="crm">
                        <span class="nav-item-text">CRM</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Analytics</div>
                    <div class="nav-item" data-section="insights">
                        <span class="nav-item-text">AI Insights</span>
                    </div>
                    <div class="nav-item" data-section="learning">
                        <span class="nav-item-text">Cross-Client Learning</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Account</div>
                    <div class="nav-item" data-section="settings">
                        <span class="nav-item-text">Settings</span>
                    </div>
                    <div class="nav-item" onclick="logout()">
                        <span class="nav-item-text">Sign Out</span>
                    </div>
                </div>
            </div>
        </nav>
        
        <main class="main-content">
            <div class="top-bar">
                <div class="top-bar-left">
                    <h1 class="page-title" id="pageTitle">Dashboard Overview</h1>
                    <span class="tier-badge tier-1" id="tierBadge">Marketing Starter</span>
                </div>
                <div class="top-bar-right">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span id="userName">User</span>
                    </div>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Overview Section -->
                <div id="overviewSection">
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <div class="card-title">Platform Status</div>
                                <div class="card-status">
                                    <div class="status-dot status-online" id="platformStatusDot"></div>
                                    <span id="platformStatusText">Online</span>
                                </div>
                            </div>
                            <div class="card-metric" id="agentCount">46</div>
                            <div class="card-description">AI Agents Active</div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <div class="card-title">Services</div>
                            </div>
                            <div class="service-list" id="serviceList">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    Loading services...
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <div class="card-title">Quick Access</div>
                            </div>
                            <div style="display: grid; gap: 0.75rem;">
                                <a href="#" class="btn btn-primary" onclick="openService('wagtail')">
                                    Manage Content (CMS)
                                </a>
                                <a href="#" class="btn btn-secondary" onclick="openService('saleor')">
                                    E-commerce Dashboard
                                </a>
                                <a href="#" class="btn btn-secondary" onclick="showSection('agents')">
                                    View AI Agents
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Agents Section -->
                <div id="agentsSection" class="hidden">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">AI Agent Ecosystem</div>
                            <div class="card-status">
                                <div class="status-dot status-online"></div>
                                <span>46 Agents Active</span>
                            </div>
                        </div>
                        <div class="agents-grid" id="agentsGrid">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading AI agents...
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Wagtail Section -->
                <div id="wagtailSection" class="hidden">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Wagtail CMS Integration</div>
                            <div class="card-status">
                                <div class="status-dot status-online" id="wagtailStatus"></div>
                                <span id="wagtailStatusText">Connected</span>
                            </div>
                        </div>
                        <p>Multi-tenant CMS powered by Wagtail. Manage content for your organization.</p>
                        <div style="margin-top: 1rem;">
                            <a href="http://localhost:8006/admin" target="_blank" class="btn btn-primary">
                                Open CMS Admin
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Saleor Section -->
                <div id="saleorSection" class="hidden">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Saleor E-commerce Integration</div>
                            <div class="card-status">
                                <div class="status-dot status-online" id="saleorStatus"></div>
                                <span id="saleorStatusText">Connected</span>
                            </div>
                        </div>
                        <p>Multi-tenant e-commerce platform with organization-based isolation.</p>
                        <div style="margin-top: 1rem;">
                            <a href="http://localhost:9000" target="_blank" class="btn btn-primary">
                                Open Saleor Dashboard
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- AI Insights Section -->
                <div id="insightsSection" class="hidden">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">Cross-Client AI Learning</div>
                        </div>
                        <p>AI insights and patterns learned across all platform tenants while preserving privacy.</p>
                        <div id="insightsGrid" class="dashboard-grid" style="margin-top: 1rem;">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading AI insights...
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Other sections would go here... -->
                <div id="crmSection" class="hidden">
                    <div class="dashboard-card">
                        <div class="card-title">CRM Integration</div>
                        <p>Customer relationship management coming soon...</p>
                    </div>
                </div>
                
                <div id="learningSection" class="hidden">
                    <div class="dashboard-card">
                        <div class="card-title">Cross-Client Learning</div>
                        <p>AI learning insights coming soon...</p>
                    </div>
                </div>
                
                <div id="settingsSection" class="hidden">
                    <div class="dashboard-card">
                        <div class="card-title">Account Settings</div>
                        <p>Account configuration coming soon...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:8082';
        
        // Services configuration
        const SERVICES = [
            { name: 'API Gateway', url: 'localhost:8082', port: 8082, path: '/health' },
            { name: 'AI Agents', url: 'localhost:8000', port: 8000, path: '/health' },
            { name: 'Wagtail CMS', url: 'localhost:8006', port: 8006, path: '/admin' },
            { name: 'Saleor E-commerce', url: 'localhost:9000', port: 9000, path: '/dashboard' },
            { name: 'Analytics Service', url: 'localhost:8004', port: 8004, path: '/health' },
            { name: 'Integration Service', url: 'localhost:8005', port: 8005, path: '/health' }
        ];
        
        // Global state
        let currentUser = null;
        let currentSection = 'overview';
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
        });
        
        async function initializeDashboard() {
            // Check authentication
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/unified-auth.html';
                return;
            }
            
            // Load user data
            currentUser = JSON.parse(localStorage.getItem('user') || '{}');
            updateUserInfo();
            
            // Setup navigation
            setupNavigation();
            
            // Load initial data
            await loadDashboardData();
        }
        
        function updateUserInfo() {
            if (currentUser.email) {
                document.getElementById('userName').textContent = currentUser.email;
                document.getElementById('userAvatar').textContent = currentUser.email.charAt(0).toUpperCase();
            }
            
            // Update tier badge (assuming tier info is in user data)
            const tier = currentUser.subscription_tier || 'tier_1';
            const tierBadge = document.getElementById('tierBadge');
            const tierNames = {
                'tier_1': 'Marketing Starter',
                'tier_2': 'Growth Accelerator',
                'tier_3': 'Enterprise Scale'
            };
            
            tierBadge.textContent = tierNames[tier];
            tierBadge.className = `tier-badge ${tier}`;
        }
        
        function setupNavigation() {
            document.querySelectorAll('.nav-item[data-section]').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    showSection(section);
                });
            });
        }
        
        function showSection(sectionName) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`)?.classList.add('active');
            
            // Hide all sections
            document.querySelectorAll('[id$="Section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                currentSection = sectionName;
                
                // Update page title
                const titles = {
                    'overview': 'Dashboard Overview',
                    'agents': 'AI Agents',
                    'wagtail': 'Wagtail CMS',
                    'saleor': 'Saleor E-commerce',
                    'crm': 'CRM System',
                    'insights': 'AI Insights',
                    'learning': 'Cross-Client Learning',
                    'settings': 'Settings'
                };
                document.getElementById('pageTitle').textContent = titles[sectionName] || 'Dashboard';
                
                // Load section-specific data
                loadSectionData(sectionName);
            }
        }
        
        async function loadDashboardData() {
            await Promise.all([
                checkPlatformStatus(),
                loadServices(),
                loadAgents()
            ]);
        }
        
        async function checkPlatformStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                const statusDot = document.getElementById('platformStatusDot');
                const statusText = document.getElementById('platformStatusText');
                
                if (response.ok) {
                    statusDot.className = 'status-dot status-online';
                    statusText.textContent = 'Online';
                } else {
                    statusDot.className = 'status-dot status-warning';
                    statusText.textContent = 'Warning';
                }
            } catch (error) {
                const statusDot = document.getElementById('platformStatusDot');
                const statusText = document.getElementById('platformStatusText');
                statusDot.className = 'status-dot status-offline';
                statusText.textContent = 'Offline';
            }
        }
        
        async function loadServices() {
            const serviceList = document.getElementById('serviceList');
            serviceList.innerHTML = '';
            
            for (const service of SERVICES) {
                const serviceItem = document.createElement('div');
                serviceItem.className = 'service-item';
                serviceItem.onclick = () => openService(service.name.toLowerCase().replace(/\s+/g, ''));
                
                let status = 'offline';
                try {
                    const response = await fetch(`http://${service.url}${service.path}`, { 
                        mode: 'no-cors',
                        timeout: 5000 
                    });
                    status = 'online';
                } catch (error) {
                    // Check if it's a CORS error (which means the service is running)
                    if (error.message.includes('CORS') || error.name === 'TypeError') {
                        status = 'online';
                    }
                }
                
                serviceItem.innerHTML = `
                    <div class="service-info">
                        <div class="status-dot status-${status}"></div>
                        <div>
                            <div class="service-name">${service.name}</div>
                            <div class="service-url">${service.url}</div>
                        </div>
                    </div>
                    <span style="color: #a0aec0;">â†’</span>
                `;
                
                serviceList.appendChild(serviceItem);
            }
        }
        
        async function loadAgents() {
            // This would fetch from the AI agents service
            // For now, showing static data
            const agentsData = [
                { name: 'Marketing Campaign Manager', description: 'Creates and optimizes marketing campaigns', status: 'active' },
                { name: 'Content Generator', description: 'Generates marketing content and copy', status: 'active' },
                { name: 'SEO Optimizer', description: 'Optimizes content for search engines', status: 'active' },
                { name: 'Social Media Manager', description: 'Manages social media presence', status: 'active' },
                { name: 'Analytics Reporter', description: 'Generates performance reports', status: 'active' },
                { name: 'Lead Qualifier', description: 'Qualifies and scores leads', status: 'active' }
            ];
            
            const agentsGrid = document.getElementById('agentsGrid');
            agentsGrid.innerHTML = '';
            
            agentsData.forEach(agent => {
                const agentCard = document.createElement('div');
                agentCard.className = 'agent-card';
                agentCard.innerHTML = `
                    <div class="agent-name">${agent.name}</div>
                    <div class="agent-description">${agent.description}</div>
                    <div class="agent-status">
                        <div class="status-dot status-online"></div>
                        <span>${agent.status}</span>
                    </div>
                `;
                agentsGrid.appendChild(agentCard);
            });
        }
        
        async function loadSectionData(sectionName) {
            switch (sectionName) {
                case 'insights':
                    await loadAIInsights();
                    break;
                // Add other section-specific loaders
            }
        }
        
        async function loadAIInsights() {
            const insightsGrid = document.getElementById('insightsGrid');
            
            // Mock insights data
            const insights = [
                { title: 'Campaign Performance', metric: '87%', description: 'Average conversion rate improvement' },
                { title: 'Content Optimization', metric: '12x', description: 'Better engagement from AI-optimized content' },
                { title: 'Cross-Client Patterns', metric: '234', description: 'Learning patterns identified across tenants' }
            ];
            
            insightsGrid.innerHTML = insights.map(insight => `
                <div class="dashboard-card">
                    <div class="card-title">${insight.title}</div>
                    <div class="card-metric">${insight.metric}</div>
                    <div class="card-description">${insight.description}</div>
                </div>
            `).join('');
        }
        
        function openService(serviceName) {
            const serviceMap = {
                'wagtail': 'http://localhost:8006/admin',
                'saleor': 'http://localhost:9000',
                'crm': 'http://localhost:8003',
                'analytics': 'http://localhost:8004',
                'api gateway': 'http://localhost:8082/docs'
            };
            
            const url = serviceMap[serviceName.toLowerCase()];
            if (url) {
                window.open(url, '_blank');
            }
        }
        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('domain');
            window.location.href = '/unified-auth.html';
        }
    </script>
</body>
</html>